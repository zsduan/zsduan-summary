{"version":3,"sources":["webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/Utils.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/HandshakeProtocol.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/Loggers.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/Errors.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/HttpClient.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/FetchHttpClient.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/XhrHttpClient.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/IHubProtocol.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/DefaultHttpClient.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/Subject.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/HubConnection.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/ITransport.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/DefaultReconnectPolicy.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/AbortController.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/LongPollingTransport.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/ServerSentEventsTransport.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/WebSocketTransport.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/HttpConnection.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/JsonHubProtocol.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/HubConnectionBuilder.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/TextMessageFormat.js","webpack:///./node_modules/_@microsoft_signalr@5.0.17@@microsoft/signalr/dist/esm/ILogger.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","v","op","TypeError","pop","push","VERSION","Arg","isRequired","val","name","undefined","Error","isNotEmpty","match","isIn","values","Platform","defineProperty","get","window","enumerable","configurable","self","isBrowser","isWebWorker","getDataDetail","data","includeContent","detail","isArrayBuffer","byteLength","formatArrayBuffer","view","Uint8Array","str","forEach","num","pad","toString","substr","ArrayBuffer","constructor","sendMessage","logger","transportName","httpClient","url","accessTokenFactory","content","logMessageContent","withCredentials","defaultHeaders","_a","headers","token","_b","responseType","response","_c","getUserAgentHeader","log","Trace","post","statusCode","createLogger","ConsoleLogger","Information","instance","SubjectSubscription","subject","observer","dispose","index","observers","indexOf","splice","cancelCallback","catch","minimumLogLevel","outputConsole","console","logLevel","message","Critical","error","Date","toISOString","Warning","warn","info","userAgentHeaderName","isNode","constructUserAgent","getOsName","getRuntime","getRuntimeVersion","version","os","runtime","runtimeVersion","userAgent","majorAndMinor","split","process","platform","versions","node","HandshakeProtocol","writeHandshakeRequest","handshakeRequest","write","JSON","stringify","parseHandshakeResponse","responseMessage","messageData","remainingData","Buffer","binaryData","separatorIndex","RecordSeparatorCode","responseLength","String","fromCharCode","slice","buffer","textData","RecordSeparator","substring","messages","parse","type","NullLogger","_logLevel","_message","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","__","create","HttpError","_super","errorMessage","_newTarget","_this","trueProto","TimeoutError","AbortError","HttpResponse","statusText","HttpClient","options","send","method","delete","getCookieString","FetchHttpClient","fetch","requireFunc","jar","CookieJar","fetchType","abortControllerType","bind","AbortController","request","abortController","timeoutId","msTimeout","e_1","payload","abortSignal","aborted","onabort","abort","timeout","setTimeout","cache","credentials","mode","redirect","signal","clearTimeout","ok","status","deserializeContent","cookies","getCookies","c","join","arrayBuffer","text","MessageType","XhrHttpClient","xhr","XMLHttpRequest","open","setRequestHeader","keys","header","onload","responseText","onerror","ontimeout","DefaultHttpClient","HubConnectionState","Subject","item","_i","err","complete","subscribe","DEFAULT_TIMEOUT_IN_MS","DEFAULT_PING_INTERVAL_IN_MS","HttpTransportType","TransferFormat","HubConnection","connection","protocol","reconnectPolicy","nextKeepAlive","serverTimeoutInMilliseconds","keepAliveIntervalInMilliseconds","handshakeProtocol","onreceive","processIncomingData","onclose","connectionClosed","callbacks","methods","closedCallbacks","reconnectingCallbacks","reconnectedCallbacks","invocationId","receivedHandshakeResponse","connectionState","Disconnected","connectionStarted","cachedPingMessage","writeMessage","Ping","connectionId","baseUrl","set","Reconnecting","start","startPromise","startWithStateTransitions","Connecting","Debug","startInternal","Connected","handshakePromise","e_2","stopDuringStartError","handshakeResolver","handshakeRejecter","transferFormat","cleanupTimeout","resetTimeoutPeriod","resetKeepAliveInterval","cleanupPingTimer","stop","stopPromise","stopInternal","Disconnecting","reconnectDelayHandle","completeClose","stream","methodName","args","promiseQueue","replaceStreamingParams","streams","streamIds","invocationDescriptor","createStreamInvocation","cancelInvocation","createCancelInvocation","sendWithProtocol","invocationEvent","Completion","launchStreams","sendPromise","createInvocation","invoke","on","newMethod","toLowerCase","off","handlers","removeIdx","callback","onreconnecting","onreconnected","processHandshakeResponse","parseMessages","messages_1","Invocation","invokeClientMethod","StreamItem","Close","allowReconnect","features","inherentKeepAlive","getTime","timeoutHandle","serverTimeout","pingServerHandle","nextPing","invocationMessage","target","m","cancelCallbacksWithError","reconnect","reconnectStartTime","previousReconnectAttempts","retryError","nextRetryDelay","e_4","now","getNextRetryDelay","previousRetryCount","elapsedMilliseconds","retryReason","nextRetryDelayInMilliseconds","key","nonblocking","_loop_1","streamId","createCompletionMessage","createStreamItemMessage","argument","isObservable","arg","StreamInvocation","id","CancelInvocation","DEFAULT_RETRY_DELAYS_IN_MILLISECONDS","DefaultReconnectPolicy","retryDelays","concat","retryContext","isAborted","LongPollingTransport","pollAbort","running","connect","pollOptions","pollUrl","Binary","getAccessToken","updateHeaderToken","closeError","receiving","poll","pollAborted","raiseOnClose","name_1","deleteOptions","logMessage","ServerSentEventsTransport","eventSourceConstructor","encodeURIComponent","opened","Text","eventSource","Cookie","onmessage","close","onopen","WebSocketTransport","webSocketConstructor","webSocket","replace","binaryType","_event","event","ErrorEvent","readyState","OPEN","isCloseEvent","wasClean","code","reason","MAX_REDIRECTS","HttpConnection","stopPromiseResolver","negotiateVersion","resolveUrl","webSocketModule","eventSourceModule","WebSocket","EventSource","startInternalPromise","sendQueue","TransportSendQueue","transport","stopError","stopConnection","negotiateResponse","redirects","this_1","e_3","skipNegotiation","WebSockets","constructTransport","startTransport","accessToken_1","getNegotiationResponse","ProtocolVersion","accessToken","createTransport","negotiateUrl","resolveNegotiateUrl","connectionToken","createConnectUrl","requestedTransport","requestedTransferFormat","connectUrl","transportExceptions","transports","negotiate","transports_1","endpoint","transportOrError","ex_1","ex_2","isITransport","availableTransports","resolveTransportOrError","ServerSentEvents","LongPolling","transportMatches","transferFormats","map","ex","lastIndexOf","document","aTag","createElement","href","actualTransport","executing","sendBufferedData","PromiseSource","transportResult","sendLoopPromise","sendLoop","bufferData","promise","error_1","concatBuffers","arrayBuffers","totalLength","reduce","a","offset","arrayBuffers_1","resolver","rejecter","JSON_HUB_PROTOCOL_NAME","JsonHubProtocol","input","TextMessageFormat","hubMessages","parsedMessage","isInvocationMessage","isStreamItemMessage","isCompletionMessage","assertNotEmptyString","LogLevelNameMapping","trace","debug","information","warning","critical","none","None","parseLogLevel","mapping","HubConnectionBuilder","configureLogging","logging","isLogger","withUrl","transportTypeOrOptions","httpConnectionOptions","withHubProtocol","withAutomaticReconnect","retryDelaysOrReconnectPolicy","isArray","build","output","LogLevel"],"mappings":"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","file":"static/js/chunk-3a0cdb68.1451283f.js","sourcesContent":["// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\nexport var VERSION = \"5.0.17\";\r\n/** @private */\r\nvar Arg = /** @class */ (function () {\r\n    function Arg() {\r\n    }\r\n    Arg.isRequired = function (val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(\"The '\" + name + \"' argument is required.\");\r\n        }\r\n    };\r\n    Arg.isNotEmpty = function (val, name) {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(\"The '\" + name + \"' argument should not be empty.\");\r\n        }\r\n    };\r\n    Arg.isIn = function (val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(\"Unknown \" + name + \" value: \" + val + \".\");\r\n        }\r\n    };\r\n    return Arg;\r\n}());\r\nexport { Arg };\r\n/** @private */\r\nvar Platform = /** @class */ (function () {\r\n    function Platform() {\r\n    }\r\n    Object.defineProperty(Platform, \"isBrowser\", {\r\n        get: function () {\r\n            return typeof window === \"object\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isWebWorker\", {\r\n        get: function () {\r\n            return typeof self === \"object\" && \"importScripts\" in self;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isNode\", {\r\n        get: function () {\r\n            return !this.isBrowser && !this.isWebWorker;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Platform;\r\n}());\r\nexport { Platform };\r\n/** @private */\r\nexport function getDataDetail(data, includeContent) {\r\n    var detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = \"Binary data of length \" + data.byteLength;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + formatArrayBuffer(data) + \"'\";\r\n        }\r\n    }\r\n    else if (typeof data === \"string\") {\r\n        detail = \"String data of length \" + data.length;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + data + \"'\";\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n/** @private */\r\nexport function formatArrayBuffer(data) {\r\n    var view = new Uint8Array(data);\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    var str = \"\";\r\n    view.forEach(function (num) {\r\n        var pad = num < 16 ? \"0\" : \"\";\r\n        str += \"0x\" + pad + num.toString(16) + \" \";\r\n    });\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val) {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n/** @private */\r\nexport function sendMessage(logger, transportName, httpClient, url, accessTokenFactory, content, logMessageContent, withCredentials, defaultHeaders) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, headers, token, _b, name, value, responseType, response;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    headers = {};\r\n                    if (!accessTokenFactory) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, accessTokenFactory()];\r\n                case 1:\r\n                    token = _c.sent();\r\n                    if (token) {\r\n                        headers = (_a = {},\r\n                            _a[\"Authorization\"] = \"Bearer \" + token,\r\n                            _a);\r\n                    }\r\n                    _c.label = 2;\r\n                case 2:\r\n                    _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                    headers[name] = value;\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) sending data. \" + getDataDetail(content, logMessageContent) + \".\");\r\n                    responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n                    return [4 /*yield*/, httpClient.post(url, {\r\n                            content: content,\r\n                            headers: __assign({}, headers, defaultHeaders),\r\n                            responseType: responseType,\r\n                            withCredentials: withCredentials,\r\n                        })];\r\n                case 3:\r\n                    response = _c.sent();\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) request complete. Response status: \" + response.statusCode + \".\");\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** @private */\r\nexport function createLogger(logger) {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n    if (logger.log) {\r\n        return logger;\r\n    }\r\n    return new ConsoleLogger(logger);\r\n}\r\n/** @private */\r\nvar SubjectSubscription = /** @class */ (function () {\r\n    function SubjectSubscription(subject, observer) {\r\n        this.subject = subject;\r\n        this.observer = observer;\r\n    }\r\n    SubjectSubscription.prototype.dispose = function () {\r\n        var index = this.subject.observers.indexOf(this.observer);\r\n        if (index > -1) {\r\n            this.subject.observers.splice(index, 1);\r\n        }\r\n        if (this.subject.observers.length === 0 && this.subject.cancelCallback) {\r\n            this.subject.cancelCallback().catch(function (_) { });\r\n        }\r\n    };\r\n    return SubjectSubscription;\r\n}());\r\nexport { SubjectSubscription };\r\n/** @private */\r\nvar ConsoleLogger = /** @class */ (function () {\r\n    function ConsoleLogger(minimumLogLevel) {\r\n        this.minimumLogLevel = minimumLogLevel;\r\n        this.outputConsole = console;\r\n    }\r\n    ConsoleLogger.prototype.log = function (logLevel, message) {\r\n        if (logLevel >= this.minimumLogLevel) {\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.outputConsole.error(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.outputConsole.warn(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.outputConsole.info(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.outputConsole.log(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    return ConsoleLogger;\r\n}());\r\nexport { ConsoleLogger };\r\n/** @private */\r\nexport function getUserAgentHeader() {\r\n    var userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\r\n}\r\n/** @private */\r\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    var userAgent = \"Microsoft SignalR/\";\r\n    var majorAndMinor = version.split(\".\");\r\n    userAgent += majorAndMinor[0] + \".\" + majorAndMinor[1];\r\n    userAgent += \" (\" + version + \"; \";\r\n    if (os && os !== \"\") {\r\n        userAgent += os + \"; \";\r\n    }\r\n    else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n    userAgent += \"\" + runtime;\r\n    if (runtimeVersion) {\r\n        userAgent += \"; \" + runtimeVersion;\r\n    }\r\n    else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\nfunction getOsName() {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\nfunction getRuntimeVersion() {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\nfunction getRuntime() {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    }\r\n    else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n//# sourceMappingURL=Utils.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nvar HandshakeProtocol = /** @class */ (function () {\r\n    function HandshakeProtocol() {\r\n    }\r\n    // Handshake request is always JSON\r\n    HandshakeProtocol.prototype.writeHandshakeRequest = function (handshakeRequest) {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    };\r\n    HandshakeProtocol.prototype.parseHandshakeResponse = function (data) {\r\n        var responseMessage;\r\n        var messageData;\r\n        var remainingData;\r\n        if (isArrayBuffer(data) || (typeof Buffer !== \"undefined\" && data instanceof Buffer)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            var binaryData = new Uint8Array(data);\r\n            var separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        }\r\n        else {\r\n            var textData = data;\r\n            var separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n        // At this point we should have just the single handshake message\r\n        var messages = TextMessageFormat.parse(messageData);\r\n        var response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        responseMessage = response;\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    };\r\n    return HandshakeProtocol;\r\n}());\r\nexport { HandshakeProtocol };\r\n//# sourceMappingURL=HandshakeProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** A logger that does nothing when log messages are sent to it. */\r\nvar NullLogger = /** @class */ (function () {\r\n    function NullLogger() {\r\n    }\r\n    /** @inheritDoc */\r\n    // tslint:disable-next-line\r\n    NullLogger.prototype.log = function (_logLevel, _message) {\r\n    };\r\n    /** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\n    NullLogger.instance = new NullLogger();\r\n    return NullLogger;\r\n}());\r\nexport { NullLogger };\r\n//# sourceMappingURL=Loggers.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\n/** Error thrown when an HTTP request fails. */\r\nvar HttpError = /** @class */ (function (_super) {\r\n    __extends(HttpError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    function HttpError(errorMessage, statusCode) {\r\n        var _newTarget = this.constructor;\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        _this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return HttpError;\r\n}(Error));\r\nexport { HttpError };\r\n/** Error thrown when a timeout elapses. */\r\nvar TimeoutError = /** @class */ (function (_super) {\r\n    __extends(TimeoutError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function TimeoutError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"A timeout occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return TimeoutError;\r\n}(Error));\r\nexport { TimeoutError };\r\n/** Error thrown when an action is aborted. */\r\nvar AbortError = /** @class */ (function (_super) {\r\n    __extends(AbortError, _super);\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function AbortError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"An abort occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return AbortError;\r\n}(Error));\r\nexport { AbortError };\r\n//# sourceMappingURL=Errors.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\n/** Represents an HTTP response. */\r\nvar HttpResponse = /** @class */ (function () {\r\n    function HttpResponse(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n    return HttpResponse;\r\n}());\r\nexport { HttpResponse };\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nvar HttpClient = /** @class */ (function () {\r\n    function HttpClient() {\r\n    }\r\n    HttpClient.prototype.get = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"GET\", url: url }));\r\n    };\r\n    HttpClient.prototype.post = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"POST\", url: url }));\r\n    };\r\n    HttpClient.prototype.delete = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"DELETE\", url: url }));\r\n    };\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    HttpClient.prototype.getCookieString = function (url) {\r\n        return \"\";\r\n    };\r\n    return HttpClient;\r\n}());\r\nexport { HttpClient };\r\n//# sourceMappingURL=HttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Platform } from \"./Utils\";\r\nvar FetchHttpClient = /** @class */ (function (_super) {\r\n    __extends(FetchHttpClient, _super);\r\n    function FetchHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        if (typeof fetch === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            _this.jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n            _this.fetchType = requireFunc(\"node-fetch\");\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            _this.fetchType = requireFunc(\"fetch-cookie\")(_this.fetchType, _this.jar);\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            _this.abortControllerType = requireFunc(\"abort-controller\");\r\n        }\r\n        else {\r\n            _this.fetchType = fetch.bind(self);\r\n            _this.abortControllerType = AbortController;\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    FetchHttpClient.prototype.send = function (request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var abortController, error, timeoutId, msTimeout, response, e_1, content, payload;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Check that abort was not signaled before calling send\r\n                        if (request.abortSignal && request.abortSignal.aborted) {\r\n                            throw new AbortError();\r\n                        }\r\n                        if (!request.method) {\r\n                            throw new Error(\"No method defined.\");\r\n                        }\r\n                        if (!request.url) {\r\n                            throw new Error(\"No url defined.\");\r\n                        }\r\n                        abortController = new this.abortControllerType();\r\n                        // Hook our abortSignal into the abort controller\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = function () {\r\n                                abortController.abort();\r\n                                error = new AbortError();\r\n                            };\r\n                        }\r\n                        timeoutId = null;\r\n                        if (request.timeout) {\r\n                            msTimeout = request.timeout;\r\n                            timeoutId = setTimeout(function () {\r\n                                abortController.abort();\r\n                                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                                error = new TimeoutError();\r\n                            }, msTimeout);\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, 4, 5]);\r\n                        return [4 /*yield*/, this.fetchType(request.url, {\r\n                                body: request.content,\r\n                                cache: \"no-cache\",\r\n                                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                                headers: __assign({ \"Content-Type\": \"text/plain;charset=UTF-8\", \"X-Requested-With\": \"XMLHttpRequest\" }, request.headers),\r\n                                method: request.method,\r\n                                mode: \"cors\",\r\n                                redirect: \"manual\",\r\n                                signal: abortController.signal,\r\n                            })];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        if (error) {\r\n                            throw error;\r\n                        }\r\n                        this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + e_1 + \".\");\r\n                        throw e_1;\r\n                    case 4:\r\n                        if (timeoutId) {\r\n                            clearTimeout(timeoutId);\r\n                        }\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = null;\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 5:\r\n                        if (!response.ok) {\r\n                            throw new HttpError(response.statusText, response.status);\r\n                        }\r\n                        content = deserializeContent(response, request.responseType);\r\n                        return [4 /*yield*/, content];\r\n                    case 6:\r\n                        payload = _a.sent();\r\n                        return [2 /*return*/, new HttpResponse(response.status, response.statusText, payload)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    FetchHttpClient.prototype.getCookieString = function (url) {\r\n        var cookies = \"\";\r\n        if (Platform.isNode && this.jar) {\r\n            // @ts-ignore: unused variable\r\n            this.jar.getCookies(url, function (e, c) { return cookies = c.join(\"; \"); });\r\n        }\r\n        return cookies;\r\n    };\r\n    return FetchHttpClient;\r\n}(HttpClient));\r\nexport { FetchHttpClient };\r\nfunction deserializeContent(response, responseType) {\r\n    var content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(responseType + \" is not supported.\");\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n    return content;\r\n}\r\n//# sourceMappingURL=FetchHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nvar XhrHttpClient = /** @class */ (function (_super) {\r\n    __extends(XhrHttpClient, _super);\r\n    function XhrHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    XhrHttpClient.prototype.send = function (request) {\r\n        var _this = this;\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n            var headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach(function (header) {\r\n                    xhr.setRequestHeader(header, headers[header]);\r\n                });\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = function () {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = function () {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new HttpError(xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + xhr.status + \": \" + xhr.statusText + \".\");\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                reject(new TimeoutError());\r\n            };\r\n            xhr.send(request.content || \"\");\r\n        });\r\n    };\r\n    return XhrHttpClient;\r\n}(HttpClient));\r\nexport { XhrHttpClient };\r\n//# sourceMappingURL=XhrHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** Defines the type of a Hub Message. */\r\nexport var MessageType;\r\n(function (MessageType) {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    MessageType[MessageType[\"Invocation\"] = 1] = \"Invocation\";\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    MessageType[MessageType[\"StreamItem\"] = 2] = \"StreamItem\";\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    MessageType[MessageType[\"Completion\"] = 3] = \"Completion\";\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    MessageType[MessageType[\"StreamInvocation\"] = 4] = \"StreamInvocation\";\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    MessageType[MessageType[\"CancelInvocation\"] = 5] = \"CancelInvocation\";\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    MessageType[MessageType[\"Ping\"] = 6] = \"Ping\";\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    MessageType[MessageType[\"Close\"] = 7] = \"Close\";\r\n})(MessageType || (MessageType = {}));\r\n//# sourceMappingURL=IHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nvar DefaultHttpClient = /** @class */ (function (_super) {\r\n    __extends(DefaultHttpClient, _super);\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    function DefaultHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            _this.httpClient = new FetchHttpClient(logger);\r\n        }\r\n        else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            _this.httpClient = new XhrHttpClient(logger);\r\n        }\r\n        else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    DefaultHttpClient.prototype.send = function (request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return this.httpClient.send(request);\r\n    };\r\n    DefaultHttpClient.prototype.getCookieString = function (url) {\r\n        return this.httpClient.getCookieString(url);\r\n    };\r\n    return DefaultHttpClient;\r\n}(HttpClient));\r\nexport { DefaultHttpClient };\r\n//# sourceMappingURL=DefaultHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { SubjectSubscription } from \"./Utils\";\r\n/** Stream implementation to stream items to the server. */\r\nvar Subject = /** @class */ (function () {\r\n    function Subject() {\r\n        this.observers = [];\r\n    }\r\n    Subject.prototype.next = function (item) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            observer.next(item);\r\n        }\r\n    };\r\n    Subject.prototype.error = function (err) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.complete = function () {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.subscribe = function (observer) {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    };\r\n    return Subject;\r\n}());\r\nexport { Subject };\r\n//# sourceMappingURL=Subject.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { HandshakeProtocol } from \"./HandshakeProtocol\";\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg } from \"./Utils\";\r\nvar DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nvar DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport var HubConnectionState;\r\n(function (HubConnectionState) {\r\n    /** The hub connection is disconnected. */\r\n    HubConnectionState[\"Disconnected\"] = \"Disconnected\";\r\n    /** The hub connection is connecting. */\r\n    HubConnectionState[\"Connecting\"] = \"Connecting\";\r\n    /** The hub connection is connected. */\r\n    HubConnectionState[\"Connected\"] = \"Connected\";\r\n    /** The hub connection is disconnecting. */\r\n    HubConnectionState[\"Disconnecting\"] = \"Disconnecting\";\r\n    /** The hub connection is reconnecting. */\r\n    HubConnectionState[\"Reconnecting\"] = \"Reconnecting\";\r\n})(HubConnectionState || (HubConnectionState = {}));\r\n/** Represents a connection to a SignalR Hub. */\r\nvar HubConnection = /** @class */ (function () {\r\n    function HubConnection(connection, logger, protocol, reconnectPolicy) {\r\n        var _this = this;\r\n        this.nextKeepAlive = 0;\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.serverTimeoutInMilliseconds = DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = DEFAULT_PING_INTERVAL_IN_MS;\r\n        this.logger = logger;\r\n        this.protocol = protocol;\r\n        this.connection = connection;\r\n        this.reconnectPolicy = reconnectPolicy;\r\n        this.handshakeProtocol = new HandshakeProtocol();\r\n        this.connection.onreceive = function (data) { return _this.processIncomingData(data); };\r\n        this.connection.onclose = function (error) { return _this.connectionClosed(error); };\r\n        this.callbacks = {};\r\n        this.methods = {};\r\n        this.closedCallbacks = [];\r\n        this.reconnectingCallbacks = [];\r\n        this.reconnectedCallbacks = [];\r\n        this.invocationId = 0;\r\n        this.receivedHandshakeResponse = false;\r\n        this.connectionState = HubConnectionState.Disconnected;\r\n        this.connectionStarted = false;\r\n        this.cachedPingMessage = this.protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    HubConnection.create = function (connection, logger, protocol, reconnectPolicy) {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy);\r\n    };\r\n    Object.defineProperty(HubConnection.prototype, \"state\", {\r\n        /** Indicates the state of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connectionState;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"connectionId\", {\r\n        /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n         *  in the disconnected state or if the negotiation step was skipped.\r\n         */\r\n        get: function () {\r\n            return this.connection ? (this.connection.connectionId || null) : null;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"baseUrl\", {\r\n        /** Indicates the url of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connection.baseUrl || \"\";\r\n        },\r\n        /**\r\n         * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n         * Reconnecting states.\r\n         * @param {string} url The url to connect to.\r\n         */\r\n        set: function (url) {\r\n            if (this.connectionState !== HubConnectionState.Disconnected && this.connectionState !== HubConnectionState.Reconnecting) {\r\n                throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n            }\r\n            if (!url) {\r\n                throw new Error(\"The HubConnection url must be a valid url.\");\r\n            }\r\n            this.connection.baseUrl = url;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.start = function () {\r\n        this.startPromise = this.startWithStateTransitions();\r\n        return this.startPromise;\r\n    };\r\n    HubConnection.prototype.startWithStateTransitions = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState !== HubConnectionState.Disconnected) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Connecting;\r\n                        this.logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.connectionStarted = true;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        this.connectionState = HubConnectionState.Disconnected;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection failed to start successfully because of error '\" + e_1 + \"'.\");\r\n                        return [2 /*return*/, Promise.reject(e_1)];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.startInternal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var handshakePromise, handshakeRequest, e_2;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.stopDuringStartError = undefined;\r\n                        this.receivedHandshakeResponse = false;\r\n                        handshakePromise = new Promise(function (resolve, reject) {\r\n                            _this.handshakeResolver = resolve;\r\n                            _this.handshakeRejecter = reject;\r\n                        });\r\n                        return [4 /*yield*/, this.connection.start(this.protocol.transferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 7]);\r\n                        handshakeRequest = {\r\n                            protocol: this.protocol.name,\r\n                            version: this.protocol.version,\r\n                        };\r\n                        this.logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n                        return [4 /*yield*/, this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(handshakeRequest))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Using HubProtocol '\" + this.protocol.name + \"'.\");\r\n                        // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n                        this.cleanupTimeout();\r\n                        this.resetTimeoutPeriod();\r\n                        this.resetKeepAliveInterval();\r\n                        return [4 /*yield*/, handshakePromise];\r\n                    case 4:\r\n                        _a.sent();\r\n                        // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n                        // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n                        // and the connection was closed.\r\n                        if (this.stopDuringStartError) {\r\n                            // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                            // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                            // will cause the calling continuation to get scheduled to run later.\r\n                            throw this.stopDuringStartError;\r\n                        }\r\n                        return [3 /*break*/, 7];\r\n                    case 5:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Debug, \"Hub handshake failed with error '\" + e_2 + \"' during start(). Stopping HubConnection.\");\r\n                        this.cleanupTimeout();\r\n                        this.cleanupPingTimer();\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        return [4 /*yield*/, this.connection.stop(e_2)];\r\n                    case 6:\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        _a.sent();\r\n                        throw e_2;\r\n                    case 7: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var startPromise, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        startPromise = this.startPromise;\r\n                        this.stopPromise = this.stopInternal();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        // Awaiting undefined continues immediately\r\n                        return [4 /*yield*/, startPromise];\r\n                    case 3:\r\n                        // Awaiting undefined continues immediately\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_3 = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.stopInternal = function (error) {\r\n        if (this.connectionState === HubConnectionState.Disconnected) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HubConnection.stop(\" + error + \") ignored because it is already in the disconnected state.\");\r\n            return Promise.resolve();\r\n        }\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n            return this.stopPromise;\r\n        }\r\n        this.connectionState = HubConnectionState.Disconnecting;\r\n        this.logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n        if (this.reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this.logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n            clearTimeout(this.reconnectDelayHandle);\r\n            this.reconnectDelayHandle = undefined;\r\n            this.completeClose();\r\n            return Promise.resolve();\r\n        }\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        this.stopDuringStartError = error || new Error(\"The connection was stopped before the hub handshake could complete.\");\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    };\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    HubConnection.prototype.stream = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createStreamInvocation(methodName, args, streamIds);\r\n        var promiseQueue;\r\n        var subject = new Subject();\r\n        subject.cancelCallback = function () {\r\n            var cancelInvocation = _this.createCancelInvocation(invocationDescriptor.invocationId);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n            return promiseQueue.then(function () {\r\n                return _this.sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n        this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    }\r\n                    else {\r\n                        subject.complete();\r\n                    }\r\n                }\r\n                else {\r\n                    subject.next((invocationEvent.item));\r\n                }\r\n            }\r\n        };\r\n        promiseQueue = this.sendWithProtocol(invocationDescriptor)\r\n            .catch(function (e) {\r\n            subject.error(e);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        this.launchStreams(streams, promiseQueue);\r\n        return subject;\r\n    };\r\n    HubConnection.prototype.sendMessage = function (message) {\r\n        this.resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    };\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    HubConnection.prototype.sendWithProtocol = function (message) {\r\n        return this.sendMessage(this.protocol.writeMessage(message));\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.send = function (methodName) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var sendPromise = this.sendWithProtocol(this.createInvocation(methodName, args, true, streamIds));\r\n        this.launchStreams(streams, sendPromise);\r\n        return sendPromise;\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    HubConnection.prototype.invoke = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createInvocation(methodName, args, false, streamIds);\r\n        var p = new Promise(function (resolve, reject) {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            _this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        }\r\n                        else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(new Error(\"Unexpected message type: \" + invocationEvent.type));\r\n                    }\r\n                }\r\n            };\r\n            var promiseQueue = _this.sendWithProtocol(invocationDescriptor)\r\n                .catch(function (e) {\r\n                reject(e);\r\n                // invocationId will always have a value for a non-blocking invocation\r\n                delete _this.callbacks[invocationDescriptor.invocationId];\r\n            });\r\n            _this.launchStreams(streams, promiseQueue);\r\n        });\r\n        return p;\r\n    };\r\n    /** Registers a handler that will be invoked when the hub method with the specified method name is invoked.\r\n     *\r\n     * @param {string} methodName The name of the hub method to define.\r\n     * @param {Function} newMethod The handler that will be raised when the hub method is invoked.\r\n     */\r\n    HubConnection.prototype.on = function (methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this.methods[methodName]) {\r\n            this.methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this.methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this.methods[methodName].push(newMethod);\r\n    };\r\n    HubConnection.prototype.off = function (methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        var handlers = this.methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            var removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this.methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this.methods[methodName];\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    HubConnection.prototype.onclose = function (callback) {\r\n        if (callback) {\r\n            this.closedCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    HubConnection.prototype.onreconnecting = function (callback) {\r\n        if (callback) {\r\n            this.reconnectingCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    HubConnection.prototype.onreconnected = function (callback) {\r\n        if (callback) {\r\n            this.reconnectedCallbacks.push(callback);\r\n        }\r\n    };\r\n    HubConnection.prototype.processIncomingData = function (data) {\r\n        this.cleanupTimeout();\r\n        if (!this.receivedHandshakeResponse) {\r\n            data = this.processHandshakeResponse(data);\r\n            this.receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            var messages = this.protocol.parseMessages(data, this.logger);\r\n            for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n                var message = messages_1[_i];\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this.invokeClientMethod(message);\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion:\r\n                        var callback = this.callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this.callbacks[message.invocationId];\r\n                            }\r\n                            callback(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close:\r\n                        this.logger.log(LogLevel.Information, \"Close message received from server.\");\r\n                        var error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n                            // tslint:disable-next-line:no-floating-promises\r\n                            this.connection.stop(error);\r\n                        }\r\n                        else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this.stopPromise = this.stopInternal(error);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this.logger.log(LogLevel.Warning, \"Invalid message type: \" + message.type + \".\");\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.resetTimeoutPeriod();\r\n    };\r\n    HubConnection.prototype.processHandshakeResponse = function (data) {\r\n        var _a;\r\n        var responseMessage;\r\n        var remainingData;\r\n        try {\r\n            _a = this.handshakeProtocol.parseHandshakeResponse(data), remainingData = _a[0], responseMessage = _a[1];\r\n        }\r\n        catch (e) {\r\n            var message = \"Error parsing handshake response: \" + e;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            var message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n        this.handshakeResolver();\r\n        return remainingData;\r\n    };\r\n    HubConnection.prototype.resetKeepAliveInterval = function () {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this.nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n        this.cleanupPingTimer();\r\n    };\r\n    HubConnection.prototype.resetTimeoutPeriod = function () {\r\n        var _this = this;\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this.timeoutHandle = setTimeout(function () { return _this.serverTimeout(); }, this.serverTimeoutInMilliseconds);\r\n            // Set keepAlive timer if there isn't one\r\n            if (this.pingServerHandle === undefined) {\r\n                var nextPing = this.nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this.pingServerHandle = setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (!(this.connectionState === HubConnectionState.Connected)) return [3 /*break*/, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4 /*yield*/, this.sendMessage(this.cachedPingMessage)];\r\n                            case 2:\r\n                                _b.sent();\r\n                                return [3 /*break*/, 4];\r\n                            case 3:\r\n                                _a = _b.sent();\r\n                                // We don't care about the error. It should be seen elsewhere in the client.\r\n                                // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                                this.cleanupPingTimer();\r\n                                return [3 /*break*/, 4];\r\n                            case 4: return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); }, nextPing);\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.serverTimeout = function () {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // tslint:disable-next-line:no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    };\r\n    HubConnection.prototype.invokeClientMethod = function (invocationMessage) {\r\n        var _this = this;\r\n        var methods = this.methods[invocationMessage.target.toLowerCase()];\r\n        if (methods) {\r\n            try {\r\n                methods.forEach(function (m) { return m.apply(_this, invocationMessage.arguments); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"A callback for the method \" + invocationMessage.target.toLowerCase() + \" threw error '\" + e + \"'.\");\r\n            }\r\n            if (invocationMessage.invocationId) {\r\n                // This is not supported in v1. So we return an error to avoid blocking the server waiting for the response.\r\n                var message = \"Server requested a response, which is not supported in this version of the client.\";\r\n                this.logger.log(LogLevel.Error, message);\r\n                // We don't want to wait on the stop itself.\r\n                this.stopPromise = this.stopInternal(new Error(message));\r\n            }\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Warning, \"No client method with the name '\" + invocationMessage.target + \"' found.\");\r\n        }\r\n    };\r\n    HubConnection.prototype.connectionClosed = function (error) {\r\n        this.logger.log(LogLevel.Debug, \"HubConnection.connectionClosed(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this.stopDuringStartError = this.stopDuringStartError || error || new Error(\"The underlying connection was closed before the hub handshake could complete.\");\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this.handshakeResolver) {\r\n            this.handshakeResolver();\r\n        }\r\n        this.cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.completeClose(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected && this.reconnectPolicy) {\r\n            // tslint:disable-next-line:no-floating-promises\r\n            this.reconnect(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected) {\r\n            this.completeClose(error);\r\n        }\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    };\r\n    HubConnection.prototype.completeClose = function (error) {\r\n        var _this = this;\r\n        if (this.connectionStarted) {\r\n            this.connectionState = HubConnectionState.Disconnected;\r\n            this.connectionStarted = false;\r\n            try {\r\n                this.closedCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"An onclose callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.reconnect = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var reconnectStartTime, previousReconnectAttempts, retryError, nextRetryDelay, e_4;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        reconnectStartTime = Date.now();\r\n                        previousReconnectAttempts = 0;\r\n                        retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n                        if (nextRetryDelay === null) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n                            this.completeClose(error);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Reconnecting;\r\n                        if (error) {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting because of error '\" + error + \"'.\");\r\n                        }\r\n                        else {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n                        }\r\n                        if (this.onreconnecting) {\r\n                            try {\r\n                                this.reconnectingCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnecting callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n                            }\r\n                            // Exit early if an onreconnecting callback called connection.stop().\r\n                            if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                                this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(nextRetryDelay !== null)) return [3 /*break*/, 7];\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt number \" + previousReconnectAttempts + \" will start in \" + nextRetryDelay + \" ms.\");\r\n                        return [4 /*yield*/, new Promise(function (resolve) {\r\n                                _this.reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.reconnectDelayHandle = undefined;\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n                        if (this.onreconnected) {\r\n                            try {\r\n                                this.reconnectedCallbacks.forEach(function (c) { return c.apply(_this, [_this.connection.connectionId]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnected callback called with connectionId '\" + this.connection.connectionId + \"; threw error '\" + e + \"'.\");\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                    case 5:\r\n                        e_4 = _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt failed because of error '\" + e_4 + \"'.\");\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection moved to the '\" + this.connectionState + \"' from the reconnecting state during reconnect attempt. Done reconnecting.\");\r\n                            // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                            if (this.connectionState === HubConnectionState.Disconnecting) {\r\n                                this.completeClose();\r\n                            }\r\n                            return [2 /*return*/];\r\n                        }\r\n                        retryError = e_4 instanceof Error ? e_4 : new Error(e_4.toString());\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7:\r\n                        this.logger.log(LogLevel.Information, \"Reconnect retries have been exhausted after \" + (Date.now() - reconnectStartTime) + \" ms and \" + previousReconnectAttempts + \" failed attempts. Connection disconnecting.\");\r\n                        this.completeClose();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.getNextRetryDelay = function (previousRetryCount, elapsedMilliseconds, retryReason) {\r\n        try {\r\n            return this.reconnectPolicy.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds: elapsedMilliseconds,\r\n                previousRetryCount: previousRetryCount,\r\n                retryReason: retryReason,\r\n            });\r\n        }\r\n        catch (e) {\r\n            this.logger.log(LogLevel.Error, \"IRetryPolicy.nextRetryDelayInMilliseconds(\" + previousRetryCount + \", \" + elapsedMilliseconds + \") threw error '\" + e + \"'.\");\r\n            return null;\r\n        }\r\n    };\r\n    HubConnection.prototype.cancelCallbacksWithError = function (error) {\r\n        var callbacks = this.callbacks;\r\n        this.callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach(function (key) {\r\n            var callback = callbacks[key];\r\n            callback(null, error);\r\n        });\r\n    };\r\n    HubConnection.prototype.cleanupPingTimer = function () {\r\n        if (this.pingServerHandle) {\r\n            clearTimeout(this.pingServerHandle);\r\n            this.pingServerHandle = undefined;\r\n        }\r\n    };\r\n    HubConnection.prototype.cleanupTimeout = function () {\r\n        if (this.timeoutHandle) {\r\n            clearTimeout(this.timeoutHandle);\r\n        }\r\n    };\r\n    HubConnection.prototype.createInvocation = function (methodName, args, nonblocking, streamIds) {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            var invocationId = this.invocationId;\r\n            this.invocationId++;\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.launchStreams = function (streams, promiseQueue) {\r\n        var _this = this;\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n        var _loop_1 = function (streamId) {\r\n            streams[streamId].subscribe({\r\n                complete: function () {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId)); });\r\n                },\r\n                error: function (err) {\r\n                    var message;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    }\r\n                    else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    }\r\n                    else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId, message)); });\r\n                },\r\n                next: function (item) {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createStreamItemMessage(streamId, item)); });\r\n                },\r\n            });\r\n        };\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // tslint:disable-next-line:forin\r\n        for (var streamId in streams) {\r\n            _loop_1(streamId);\r\n        }\r\n    };\r\n    HubConnection.prototype.replaceStreamingParams = function (args) {\r\n        var streams = [];\r\n        var streamIds = [];\r\n        for (var i = 0; i < args.length; i++) {\r\n            var argument = args[i];\r\n            if (this.isObservable(argument)) {\r\n                var streamId = this.invocationId;\r\n                this.invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n        return [streams, streamIds];\r\n    };\r\n    HubConnection.prototype.isObservable = function (arg) {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    };\r\n    HubConnection.prototype.createStreamInvocation = function (methodName, args, streamIds) {\r\n        var invocationId = this.invocationId;\r\n        this.invocationId++;\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds: streamIds,\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    };\r\n    HubConnection.prototype.createCancelInvocation = function (id) {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    };\r\n    HubConnection.prototype.createStreamItemMessage = function (id, item) {\r\n        return {\r\n            invocationId: id,\r\n            item: item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    };\r\n    HubConnection.prototype.createCompletionMessage = function (id, error, result) {\r\n        if (error) {\r\n            return {\r\n                error: error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n        return {\r\n            invocationId: id,\r\n            result: result,\r\n            type: MessageType.Completion,\r\n        };\r\n    };\r\n    return HubConnection;\r\n}());\r\nexport { HubConnection };\r\n//# sourceMappingURL=HubConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport var HttpTransportType;\r\n(function (HttpTransportType) {\r\n    /** Specifies no transport preference. */\r\n    HttpTransportType[HttpTransportType[\"None\"] = 0] = \"None\";\r\n    /** Specifies the WebSockets transport. */\r\n    HttpTransportType[HttpTransportType[\"WebSockets\"] = 1] = \"WebSockets\";\r\n    /** Specifies the Server-Sent Events transport. */\r\n    HttpTransportType[HttpTransportType[\"ServerSentEvents\"] = 2] = \"ServerSentEvents\";\r\n    /** Specifies the Long Polling transport. */\r\n    HttpTransportType[HttpTransportType[\"LongPolling\"] = 4] = \"LongPolling\";\r\n})(HttpTransportType || (HttpTransportType = {}));\r\n/** Specifies the transfer format for a connection. */\r\nexport var TransferFormat;\r\n(function (TransferFormat) {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Text\"] = 1] = \"Text\";\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Binary\"] = 2] = \"Binary\";\r\n})(TransferFormat || (TransferFormat = {}));\r\n//# sourceMappingURL=ITransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nvar DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n/** @private */\r\nvar DefaultReconnectPolicy = /** @class */ (function () {\r\n    function DefaultReconnectPolicy(retryDelays) {\r\n        this.retryDelays = retryDelays !== undefined ? retryDelays.concat([null]) : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n    DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds = function (retryContext) {\r\n        return this.retryDelays[retryContext.previousRetryCount];\r\n    };\r\n    return DefaultReconnectPolicy;\r\n}());\r\nexport { DefaultReconnectPolicy };\r\n//# sourceMappingURL=DefaultReconnectPolicy.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n// Not exported from index.\r\n/** @private */\r\nvar AbortController = /** @class */ (function () {\r\n    function AbortController() {\r\n        this.isAborted = false;\r\n        this.onabort = null;\r\n    }\r\n    AbortController.prototype.abort = function () {\r\n        if (!this.isAborted) {\r\n            this.isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(AbortController.prototype, \"signal\", {\r\n        get: function () {\r\n            return this;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbortController.prototype, \"aborted\", {\r\n        get: function () {\r\n            return this.isAborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return AbortController;\r\n}());\r\nexport { AbortController };\r\n//# sourceMappingURL=AbortController.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nvar LongPollingTransport = /** @class */ (function () {\r\n    function LongPollingTransport(httpClient, accessTokenFactory, logger, logMessageContent, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.pollAbort = new AbortController();\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.headers = headers;\r\n        this.running = false;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    Object.defineProperty(LongPollingTransport.prototype, \"pollAborted\", {\r\n        // This is an internal type, not exported from 'index' so this is really just internal.\r\n        get: function () {\r\n            return this.pollAbort.aborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LongPollingTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, _b, name, value, headers, pollOptions, token, pollUrl, response;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.url = url;\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n                        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n                        if (transferFormat === TransferFormat.Binary &&\r\n                            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n                            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n                        }\r\n                        _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                        headers = __assign((_a = {}, _a[name] = value, _a), this.headers);\r\n                        pollOptions = {\r\n                            abortSignal: this.pollAbort.signal,\r\n                            headers: headers,\r\n                            timeout: 100000,\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        if (transferFormat === TransferFormat.Binary) {\r\n                            pollOptions.responseType = \"arraybuffer\";\r\n                        }\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 1:\r\n                        token = _c.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 2:\r\n                        response = _c.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Mark running as false so that the poll immediately ends and runs the close logic\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            this.running = true;\r\n                        }\r\n                        this.receiving = this.poll(this.url, pollOptions);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.getAccessToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                    case 2: return [2 /*return*/, null];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.updateHeaderToken = function (request, token) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (token) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            request.headers[\"Authorization\"] = \"Bearer \" + token;\r\n            return;\r\n        }\r\n        // tslint:disable-next-line:no-string-literal\r\n        if (request.headers[\"Authorization\"]) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            delete request.headers[\"Authorization\"];\r\n        }\r\n    };\r\n    LongPollingTransport.prototype.poll = function (url, pollOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token, pollUrl, response, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, , 8, 9]);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!this.running) return [3 /*break*/, 7];\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 2:\r\n                        token = _a.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 4:\r\n                        response = _a.sent();\r\n                        if (response.statusCode === 204) {\r\n                            this.logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n                            this.running = false;\r\n                        }\r\n                        else if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Unexpected status code\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            // Process the response\r\n                            if (response.content) {\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) data received. \" + getDataDetail(response.content, this.logMessageContent) + \".\");\r\n                                if (this.onreceive) {\r\n                                    this.onreceive(response.content);\r\n                                }\r\n                            }\r\n                            else {\r\n                                // This is another way timeout manifest.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        e_1 = _a.sent();\r\n                        if (!this.running) {\r\n                            // Log but disregard errors that occur after stopping\r\n                            this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll errored after shutdown: \" + e_1.message);\r\n                        }\r\n                        else {\r\n                            if (e_1 instanceof TimeoutError) {\r\n                                // Ignore timeouts and reissue the poll.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                            else {\r\n                                // Close the connection with the error as the result.\r\n                                this.closeError = e_1;\r\n                                this.running = false;\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7: return [3 /*break*/, 9];\r\n                    case 8:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n                        // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n                        // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n                        if (!this.pollAborted) {\r\n                            this.raiseOnClose();\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 9: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.running) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"LongPolling\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, _a, name_1, value, deleteOptions, token;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n                        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n                        this.running = false;\r\n                        this.pollAbort.abort();\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, , 5, 6]);\r\n                        return [4 /*yield*/, this.receiving];\r\n                    case 2:\r\n                        _b.sent();\r\n                        // Send DELETE to clean up long polling on the server\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) sending DELETE request to \" + this.url + \".\");\r\n                        headers = {};\r\n                        _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                        headers[name_1] = value;\r\n                        deleteOptions = {\r\n                            headers: __assign({}, headers, this.headers),\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 3:\r\n                        token = _b.sent();\r\n                        this.updateHeaderToken(deleteOptions, token);\r\n                        return [4 /*yield*/, this.httpClient.delete(this.url, deleteOptions)];\r\n                    case 4:\r\n                        _b.sent();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request sent.\");\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n                        // Raise close event here instead of in polling\r\n                        // It needs to happen after the DELETE request is sent\r\n                        this.raiseOnClose();\r\n                        return [7 /*endfinally*/];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.raiseOnClose = function () {\r\n        if (this.onclose) {\r\n            var logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this.closeError) {\r\n                logMessage += \" Error: \" + this.closeError;\r\n            }\r\n            this.logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this.closeError);\r\n        }\r\n    };\r\n    return LongPollingTransport;\r\n}());\r\nexport { LongPollingTransport };\r\n//# sourceMappingURL=LongPollingTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\n/** @private */\r\nvar ServerSentEventsTransport = /** @class */ (function () {\r\n    function ServerSentEventsTransport(httpClient, accessTokenFactory, logger, logMessageContent, eventSourceConstructor, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.eventSourceConstructor = eventSourceConstructor;\r\n        this.headers = headers;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    ServerSentEventsTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n                        // set url before accessTokenFactory because this.url is only for send and we set the auth header instead of the query string for send\r\n                        this.url = url;\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            var opened = false;\r\n                            if (transferFormat !== TransferFormat.Text) {\r\n                                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                                return;\r\n                            }\r\n                            var eventSource;\r\n                            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials });\r\n                            }\r\n                            else {\r\n                                // Non-browser passes cookies via the dictionary\r\n                                var cookies = _this.httpClient.getCookieString(url);\r\n                                var headers = {};\r\n                                headers.Cookie = cookies;\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials, headers: __assign({}, headers, _this.headers) });\r\n                            }\r\n                            try {\r\n                                eventSource.onmessage = function (e) {\r\n                                    if (_this.onreceive) {\r\n                                        try {\r\n                                            _this.logger.log(LogLevel.Trace, \"(SSE transport) data received. \" + getDataDetail(e.data, _this.logMessageContent) + \".\");\r\n                                            _this.onreceive(e.data);\r\n                                        }\r\n                                        catch (error) {\r\n                                            _this.close(error);\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                };\r\n                                eventSource.onerror = function (e) {\r\n                                    var error = new Error(e.data || \"Error occurred\");\r\n                                    if (opened) {\r\n                                        _this.close(error);\r\n                                    }\r\n                                    else {\r\n                                        reject(error);\r\n                                    }\r\n                                };\r\n                                eventSource.onopen = function () {\r\n                                    _this.logger.log(LogLevel.Information, \"SSE connected to \" + _this.url);\r\n                                    _this.eventSource = eventSource;\r\n                                    opened = true;\r\n                                    resolve();\r\n                                };\r\n                            }\r\n                            catch (e) {\r\n                                reject(e);\r\n                                return;\r\n                            }\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.eventSource) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"SSE\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.stop = function () {\r\n        this.close();\r\n        return Promise.resolve();\r\n    };\r\n    ServerSentEventsTransport.prototype.close = function (e) {\r\n        if (this.eventSource) {\r\n            this.eventSource.close();\r\n            this.eventSource = undefined;\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    };\r\n    return ServerSentEventsTransport;\r\n}());\r\nexport { ServerSentEventsTransport };\r\n//# sourceMappingURL=ServerSentEventsTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n/** @private */\r\nvar WebSocketTransport = /** @class */ (function () {\r\n    function WebSocketTransport(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {\r\n        this.logger = logger;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logMessageContent = logMessageContent;\r\n        this.webSocketConstructor = webSocketConstructor;\r\n        this.httpClient = httpClient;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this.headers = headers;\r\n    }\r\n    WebSocketTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            url = url.replace(/^http/, \"ws\");\r\n                            var webSocket;\r\n                            var cookies = _this.httpClient.getCookieString(url);\r\n                            var opened = false;\r\n                            if (Platform.isNode) {\r\n                                var headers = {};\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                if (cookies) {\r\n                                    headers[\"Cookie\"] = \"\" + cookies;\r\n                                }\r\n                                // Only pass headers when in non-browser environments\r\n                                webSocket = new _this.webSocketConstructor(url, undefined, {\r\n                                    headers: __assign({}, headers, _this.headers),\r\n                                });\r\n                            }\r\n                            if (!webSocket) {\r\n                                // Chrome is not happy with passing 'undefined' as protocol\r\n                                webSocket = new _this.webSocketConstructor(url);\r\n                            }\r\n                            if (transferFormat === TransferFormat.Binary) {\r\n                                webSocket.binaryType = \"arraybuffer\";\r\n                            }\r\n                            // tslint:disable-next-line:variable-name\r\n                            webSocket.onopen = function (_event) {\r\n                                _this.logger.log(LogLevel.Information, \"WebSocket connected to \" + url + \".\");\r\n                                _this.webSocket = webSocket;\r\n                                opened = true;\r\n                                resolve();\r\n                            };\r\n                            webSocket.onerror = function (event) {\r\n                                var error = null;\r\n                                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                    error = event.error;\r\n                                }\r\n                                else {\r\n                                    error = new Error(\"There was an error with the transport.\");\r\n                                }\r\n                                reject(error);\r\n                            };\r\n                            webSocket.onmessage = function (message) {\r\n                                _this.logger.log(LogLevel.Trace, \"(WebSockets transport) data received. \" + getDataDetail(message.data, _this.logMessageContent) + \".\");\r\n                                if (_this.onreceive) {\r\n                                    try {\r\n                                        _this.onreceive(message.data);\r\n                                    }\r\n                                    catch (error) {\r\n                                        _this.close(error);\r\n                                        return;\r\n                                    }\r\n                                }\r\n                            };\r\n                            webSocket.onclose = function (event) {\r\n                                // Don't call close handler if connection was never established\r\n                                // We'll reject the connect call instead\r\n                                if (opened) {\r\n                                    _this.close(event);\r\n                                }\r\n                                else {\r\n                                    var error = null;\r\n                                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                        error = event.error;\r\n                                    }\r\n                                    else {\r\n                                        error = new Error(\"There was an error with the transport.\");\r\n                                    }\r\n                                    reject(error);\r\n                                }\r\n                            };\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WebSocketTransport.prototype.send = function (data) {\r\n        if (this.webSocket && this.webSocket.readyState === this.webSocketConstructor.OPEN) {\r\n            this.logger.log(LogLevel.Trace, \"(WebSockets transport) sending data. \" + getDataDetail(data, this.logMessageContent) + \".\");\r\n            this.webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    };\r\n    WebSocketTransport.prototype.stop = function () {\r\n        if (this.webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this.close(undefined);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WebSocketTransport.prototype.close = function (event) {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this.webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this.webSocket.onclose = function () { };\r\n            this.webSocket.onmessage = function () { };\r\n            this.webSocket.onerror = function () { };\r\n            this.webSocket.close();\r\n            this.webSocket = undefined;\r\n        }\r\n        this.logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n        if (this.onclose) {\r\n            if (this.isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(\"WebSocket closed with status code: \" + event.code + \" (\" + event.reason + \").\"));\r\n            }\r\n            else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            }\r\n            else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    };\r\n    WebSocketTransport.prototype.isCloseEvent = function (event) {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    };\r\n    return WebSocketTransport;\r\n}());\r\nexport { WebSocketTransport };\r\n//# sourceMappingURL=WebSocketTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nvar MAX_REDIRECTS = 100;\r\n/** @private */\r\nvar HttpConnection = /** @class */ (function () {\r\n    function HttpConnection(url, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.stopPromiseResolver = function () { };\r\n        this.features = {};\r\n        this.negotiateVersion = 1;\r\n        Arg.isRequired(url, \"url\");\r\n        this.logger = createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        }\r\n        else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        var webSocketModule = null;\r\n        var eventSourceModule = null;\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n        this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        this.connectionStarted = false;\r\n        this.options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    HttpConnection.prototype.start = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var message, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        transferFormat = transferFormat || TransferFormat.Binary;\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\r\n                        if (this.connectionState !== \"Disconnected\" /* Disconnected */) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = \"Connecting\" /* Connecting */;\r\n                        this.startInternalPromise = this.startInternal(transferFormat);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!(this.connectionState === \"Disconnecting\" /* Disconnecting */)) return [3 /*break*/, 3];\r\n                        message = \"Failed to start the HttpConnection before stop() was called.\";\r\n                        this.logger.log(LogLevel.Error, message);\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        _a.sent();\r\n                        return [2 /*return*/, Promise.reject(new Error(message))];\r\n                    case 3:\r\n                        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n                            message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n                            this.logger.log(LogLevel.Error, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        this.connectionStarted = true;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.send = function (data) {\r\n        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n        if (!this.sendQueue) {\r\n            this.sendQueue = new TransportSendQueue(this.transport);\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this.sendQueue.send(data);\r\n    };\r\n    HttpConnection.prototype.stop = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnected state.\");\r\n                            return [2 /*return*/, Promise.resolve()];\r\n                        }\r\n                        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n                            return [2 /*return*/, this.stopPromise];\r\n                        }\r\n                        this.connectionState = \"Disconnecting\" /* Disconnecting */;\r\n                        this.stopPromise = new Promise(function (resolve) {\r\n                            // Don't complete stop() until stopConnection() completes.\r\n                            _this.stopPromiseResolver = resolve;\r\n                        });\r\n                        // stopInternal should never throw so just observe it.\r\n                        return [4 /*yield*/, this.stopInternal(error)];\r\n                    case 1:\r\n                        // stopInternal should never throw so just observe it.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.stopInternal = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Set error as soon as possible otherwise there is a race between\r\n                        // the transport closing and providing an error and the error from a close message\r\n                        // We would prefer the close message error.\r\n                        this.stopError = error;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        if (!this.transport) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.transport.stop()];\r\n                    case 6:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"HttpConnection.transport.stop() threw error '\" + e_2 + \"'.\");\r\n                        this.stopConnection();\r\n                        return [3 /*break*/, 8];\r\n                    case 8:\r\n                        this.transport = undefined;\r\n                        return [3 /*break*/, 10];\r\n                    case 9:\r\n                        this.logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n                        _a.label = 10;\r\n                    case 10: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.startInternal = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var url, negotiateResponse, redirects, _loop_1, this_1, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this.baseUrl;\r\n                        this.accessTokenFactory = this.options.accessTokenFactory;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 12, , 13]);\r\n                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];\r\n                        if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\r\n                        // No need to add a connection ID in this case\r\n                        this.transport = this.constructTransport(HttpTransportType.WebSockets);\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        return [4 /*yield*/, this.startTransport(url, transferFormat)];\r\n                    case 2:\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                    case 4: return [3 /*break*/, 11];\r\n                    case 5:\r\n                        negotiateResponse = null;\r\n                        redirects = 0;\r\n                        _loop_1 = function () {\r\n                            var accessToken_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];\r\n                                    case 1:\r\n                                        negotiateResponse = _a.sent();\r\n                                        // the user tries to stop the connection when it is being started\r\n                                        if (this_1.connectionState === \"Disconnecting\" /* Disconnecting */ || this_1.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                                            throw new Error(\"The connection was stopped during negotiation.\");\r\n                                        }\r\n                                        if (negotiateResponse.error) {\r\n                                            throw new Error(negotiateResponse.error);\r\n                                        }\r\n                                        if (negotiateResponse.ProtocolVersion) {\r\n                                            throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                                        }\r\n                                        if (negotiateResponse.url) {\r\n                                            url = negotiateResponse.url;\r\n                                        }\r\n                                        if (negotiateResponse.accessToken) {\r\n                                            accessToken_1 = negotiateResponse.accessToken;\r\n                                            this_1.accessTokenFactory = function () { return accessToken_1; };\r\n                                        }\r\n                                        redirects++;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        };\r\n                        this_1 = this;\r\n                        _a.label = 6;\r\n                    case 6: return [5 /*yield**/, _loop_1()];\r\n                    case 7:\r\n                        _a.sent();\r\n                        _a.label = 8;\r\n                    case 8:\r\n                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                            throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                        }\r\n                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        _a.label = 11;\r\n                    case 11:\r\n                        if (this.transport instanceof LongPollingTransport) {\r\n                            this.features.inherentKeepAlive = true;\r\n                        }\r\n                        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n                            // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                            // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                            this.logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                            this.connectionState = \"Connected\" /* Connected */;\r\n                        }\r\n                        return [3 /*break*/, 13];\r\n                    case 12:\r\n                        e_3 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_3);\r\n                        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n                        this.transport = undefined;\r\n                        // if start fails, any active calls to stop assume that start will complete the stop promise\r\n                        this.stopPromiseResolver();\r\n                        return [2 /*return*/, Promise.reject(e_3)];\r\n                    case 13: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.getNegotiationResponse = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, token, _a, name, value, negotiateUrl, response, negotiateResponse, e_4;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        headers = {};\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _b.sent();\r\n                        if (token) {\r\n                            headers[\"Authorization\"] = \"Bearer \" + token;\r\n                        }\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _a = getUserAgentHeader(), name = _a[0], value = _a[1];\r\n                        headers[name] = value;\r\n                        negotiateUrl = this.resolveNegotiateUrl(url);\r\n                        this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl + \".\");\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _b.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\r\n                                content: \"\",\r\n                                headers: __assign({}, headers, this.options.headers),\r\n                                withCredentials: this.options.withCredentials,\r\n                            })];\r\n                    case 4:\r\n                        response = _b.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unexpected status code returned from negotiate '\" + response.statusCode + \"'\"))];\r\n                        }\r\n                        negotiateResponse = JSON.parse(response.content);\r\n                        if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                            // Negotiate version 0 doesn't use connectionToken\r\n                            // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                            negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n                        }\r\n                        return [2 /*return*/, negotiateResponse];\r\n                    case 5:\r\n                        e_4 = _b.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_4);\r\n                        return [2 /*return*/, Promise.reject(e_4)];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.createConnectUrl = function (url, connectionToken) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionToken);\r\n    };\r\n    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var connectUrl, transportExceptions, transports, negotiate, _i, transports_1, endpoint, transportOrError, ex_1, ex_2, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionToken);\r\n                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\r\n                        this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n                        this.transport = requestedTransport;\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.connectionId = negotiateResponse.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 2:\r\n                        transportExceptions = [];\r\n                        transports = negotiateResponse.availableTransports || [];\r\n                        negotiate = negotiateResponse;\r\n                        _i = 0, transports_1 = transports;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (!(_i < transports_1.length)) return [3 /*break*/, 13];\r\n                        endpoint = transports_1[_i];\r\n                        transportOrError = this.resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat);\r\n                        if (!(transportOrError instanceof Error)) return [3 /*break*/, 4];\r\n                        // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + transportOrError);\r\n                        return [3 /*break*/, 12];\r\n                    case 4:\r\n                        if (!this.isITransport(transportOrError)) return [3 /*break*/, 12];\r\n                        this.transport = transportOrError;\r\n                        if (!!negotiate) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.getNegotiationResponse(url)];\r\n                    case 6:\r\n                        negotiate = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        ex_1 = _a.sent();\r\n                        return [2 /*return*/, Promise.reject(ex_1)];\r\n                    case 8:\r\n                        connectUrl = this.createConnectUrl(url, negotiate.connectionToken);\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        _a.trys.push([9, 11, , 12]);\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        this.connectionId = negotiate.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 11:\r\n                        ex_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + endpoint.transport + \"': \" + ex_2);\r\n                        negotiate = undefined;\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + ex_2);\r\n                        if (this.connectionState !== \"Connecting\" /* Connecting */) {\r\n                            message = \"Failed to select transport before stop() was called.\";\r\n                            this.logger.log(LogLevel.Debug, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        return [3 /*break*/, 12];\r\n                    case 12:\r\n                        _i++;\r\n                        return [3 /*break*/, 3];\r\n                    case 13:\r\n                        if (transportExceptions.length > 0) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unable to connect to the server with any of the available transports. \" + transportExceptions.join(\" \")))];\r\n                        }\r\n                        return [2 /*return*/, Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"))];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.constructTransport = function (transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this.options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket, this.options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this.options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource, this.options.withCredentials, this.options.headers || {});\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.withCredentials, this.options.headers || {});\r\n            default:\r\n                throw new Error(\"Unknown transport: \" + transport + \".\");\r\n        }\r\n    };\r\n    HttpConnection.prototype.startTransport = function (url, transferFormat) {\r\n        var _this = this;\r\n        this.transport.onreceive = this.onreceive;\r\n        this.transport.onclose = function (e) { return _this.stopConnection(e); };\r\n        return this.transport.connect(url, transferFormat);\r\n    };\r\n    HttpConnection.prototype.resolveTransportOrError = function (endpoint, requestedTransport, requestedTransferFormat) {\r\n        var transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n            return new Error(\"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n        }\r\n        else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                var transferFormats = endpoint.transferFormats.map(function (s) { return TransferFormat[s]; });\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this.options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this.options.EventSource)) {\r\n                        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\r\n                        return new Error(\"'\" + HttpTransportType[transport] + \"' is not supported in your environment.\");\r\n                    }\r\n                    else {\r\n                        this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'.\");\r\n                        try {\r\n                            return this.constructTransport(transport);\r\n                        }\r\n                        catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\r\n                    return new Error(\"'\" + HttpTransportType[transport] + \"' does not support \" + TransferFormat[requestedTransferFormat] + \".\");\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\r\n                return new Error(\"'\" + HttpTransportType[transport] + \"' is disabled by the client.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.isITransport = function (transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    };\r\n    HttpConnection.prototype.stopConnection = function (error) {\r\n        var _this = this;\r\n        this.logger.log(LogLevel.Debug, \"HttpConnection.stopConnection(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this.stopError || error;\r\n        this.stopError = undefined;\r\n        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is already in the disconnected state.\");\r\n            return;\r\n        }\r\n        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n            this.logger.log(LogLevel.Warning, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is still in the connecting state.\");\r\n            throw new Error(\"HttpConnection.stopConnection(\" + error + \") was called while the connection is still in the connecting state.\");\r\n        }\r\n        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this.stopPromiseResolver();\r\n        }\r\n        if (error) {\r\n            this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        if (this.sendQueue) {\r\n            this.sendQueue.stop().catch(function (e) {\r\n                _this.logger.log(LogLevel.Error, \"TransportSendQueue.stop() threw error '\" + e + \"'.\");\r\n            });\r\n            this.sendQueue = undefined;\r\n        }\r\n        this.connectionId = undefined;\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        if (this.connectionStarted) {\r\n            this.connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"HttpConnection.onclose(\" + error + \") threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveUrl = function (url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (!Platform.isBrowser || !window.document) {\r\n            throw new Error(\"Cannot resolve '\" + url + \"'.\");\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        var aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\r\n        return aTag.href;\r\n    };\r\n    HttpConnection.prototype.resolveNegotiateUrl = function (url) {\r\n        var index = url.indexOf(\"?\");\r\n        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\r\n            negotiateUrl += \"/\";\r\n        }\r\n        negotiateUrl += \"negotiate\";\r\n        negotiateUrl += index === -1 ? \"\" : url.substring(index);\r\n        if (negotiateUrl.indexOf(\"negotiateVersion\") === -1) {\r\n            negotiateUrl += index === -1 ? \"?\" : \"&\";\r\n            negotiateUrl += \"negotiateVersion=\" + this.negotiateVersion;\r\n        }\r\n        return negotiateUrl;\r\n    };\r\n    return HttpConnection;\r\n}());\r\nexport { HttpConnection };\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n/** @private */\r\nvar TransportSendQueue = /** @class */ (function () {\r\n    function TransportSendQueue(transport) {\r\n        this.transport = transport;\r\n        this.buffer = [];\r\n        this.executing = true;\r\n        this.sendBufferedData = new PromiseSource();\r\n        this.transportResult = new PromiseSource();\r\n        this.sendLoopPromise = this.sendLoop();\r\n    }\r\n    TransportSendQueue.prototype.send = function (data) {\r\n        this.bufferData(data);\r\n        if (!this.transportResult) {\r\n            this.transportResult = new PromiseSource();\r\n        }\r\n        return this.transportResult.promise;\r\n    };\r\n    TransportSendQueue.prototype.stop = function () {\r\n        this.executing = false;\r\n        this.sendBufferedData.resolve();\r\n        return this.sendLoopPromise;\r\n    };\r\n    TransportSendQueue.prototype.bufferData = function (data) {\r\n        if (this.buffer.length && typeof (this.buffer[0]) !== typeof (data)) {\r\n            throw new Error(\"Expected data to be of type \" + typeof (this.buffer) + \" but was of type \" + typeof (data));\r\n        }\r\n        this.buffer.push(data);\r\n        this.sendBufferedData.resolve();\r\n    };\r\n    TransportSendQueue.prototype.sendLoop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var transportResult, data, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!true) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.sendBufferedData.promise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.executing) {\r\n                            if (this.transportResult) {\r\n                                this.transportResult.reject(\"Connection stopped.\");\r\n                            }\r\n                            return [3 /*break*/, 6];\r\n                        }\r\n                        this.sendBufferedData = new PromiseSource();\r\n                        transportResult = this.transportResult;\r\n                        this.transportResult = undefined;\r\n                        data = typeof (this.buffer[0]) === \"string\" ?\r\n                            this.buffer.join(\"\") :\r\n                            TransportSendQueue.concatBuffers(this.buffer);\r\n                        this.buffer.length = 0;\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.transport.send(data)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        transportResult.resolve();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        transportResult.reject(error_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [3 /*break*/, 0];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    TransportSendQueue.concatBuffers = function (arrayBuffers) {\r\n        var totalLength = arrayBuffers.map(function (b) { return b.byteLength; }).reduce(function (a, b) { return a + b; });\r\n        var result = new Uint8Array(totalLength);\r\n        var offset = 0;\r\n        for (var _i = 0, arrayBuffers_1 = arrayBuffers; _i < arrayBuffers_1.length; _i++) {\r\n            var item = arrayBuffers_1[_i];\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n        return result.buffer;\r\n    };\r\n    return TransportSendQueue;\r\n}());\r\nexport { TransportSendQueue };\r\nvar PromiseSource = /** @class */ (function () {\r\n    function PromiseSource() {\r\n        var _this = this;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            var _a;\r\n            return _a = [resolve, reject], _this.resolver = _a[0], _this.rejecter = _a[1], _a;\r\n        });\r\n    }\r\n    PromiseSource.prototype.resolve = function () {\r\n        this.resolver();\r\n    };\r\n    PromiseSource.prototype.reject = function (reason) {\r\n        this.rejecter(reason);\r\n    };\r\n    return PromiseSource;\r\n}());\r\n//# sourceMappingURL=HttpConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nvar JSON_HUB_PROTOCOL_NAME = \"json\";\r\n/** Implements the JSON Hub Protocol. */\r\nvar JsonHubProtocol = /** @class */ (function () {\r\n    function JsonHubProtocol() {\r\n        /** @inheritDoc */\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        /** @inheritDoc */\r\n        this.version = 1;\r\n        /** @inheritDoc */\r\n        this.transferFormat = TransferFormat.Text;\r\n    }\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    JsonHubProtocol.prototype.parseMessages = function (input, logger) {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n        // Parse the messages\r\n        var messages = TextMessageFormat.parse(input);\r\n        var hubMessages = [];\r\n        for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n            var message = messages_1[_i];\r\n            var parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this.isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this.isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this.isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    };\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    JsonHubProtocol.prototype.writeMessage = function (message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    };\r\n    JsonHubProtocol.prototype.isInvocationMessage = function (message) {\r\n        this.assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n        if (message.invocationId !== undefined) {\r\n            this.assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isStreamItemMessage = function (message) {\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isCompletionMessage = function (message) {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this.assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    };\r\n    JsonHubProtocol.prototype.assertNotEmptyString = function (value, errorMessage) {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    };\r\n    return JsonHubProtocol;\r\n}());\r\nexport { JsonHubProtocol };\r\n//# sourceMappingURL=JsonHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\n// tslint:disable:object-literal-sort-keys\r\nvar LogLevelNameMapping = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\nfunction parseLogLevel(name) {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    var mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    }\r\n    else {\r\n        throw new Error(\"Unknown log level: \" + name);\r\n    }\r\n}\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nvar HubConnectionBuilder = /** @class */ (function () {\r\n    function HubConnectionBuilder() {\r\n    }\r\n    HubConnectionBuilder.prototype.configureLogging = function (logging) {\r\n        Arg.isRequired(logging, \"logging\");\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        }\r\n        else if (typeof logging === \"string\") {\r\n            var logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        }\r\n        else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withUrl = function (url, transportTypeOrOptions) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n        this.url = url;\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, transportTypeOrOptions);\r\n        }\r\n        else {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, { transport: transportTypeOrOptions });\r\n        }\r\n        return this;\r\n    };\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    HubConnectionBuilder.prototype.withHubProtocol = function (protocol) {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.protocol = protocol;\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withAutomaticReconnect = function (retryDelaysOrReconnectPolicy) {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        }\r\n        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        }\r\n        else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n        return this;\r\n    };\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    HubConnectionBuilder.prototype.build = function () {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        var httpConnectionOptions = this.httpConnectionOptions || {};\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        var connection = new HttpConnection(this.url, httpConnectionOptions);\r\n        return HubConnection.create(connection, this.logger || NullLogger.instance, this.protocol || new JsonHubProtocol(), this.reconnectPolicy);\r\n    };\r\n    return HubConnectionBuilder;\r\n}());\r\nexport { HubConnectionBuilder };\r\nfunction isLogger(logger) {\r\n    return logger.log !== undefined;\r\n}\r\n//# sourceMappingURL=HubConnectionBuilder.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Not exported from index\r\n/** @private */\r\nvar TextMessageFormat = /** @class */ (function () {\r\n    function TextMessageFormat() {\r\n    }\r\n    TextMessageFormat.write = function (output) {\r\n        return \"\" + output + TextMessageFormat.RecordSeparator;\r\n    };\r\n    TextMessageFormat.parse = function (input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n        var messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    };\r\n    TextMessageFormat.RecordSeparatorCode = 0x1e;\r\n    TextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n    return TextMessageFormat;\r\n}());\r\nexport { TextMessageFormat };\r\n//# sourceMappingURL=TextMessageFormat.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport var LogLevel;\r\n(function (LogLevel) {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\r\n    /** Log level for low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\r\n    /** Log level for informational diagnostic messages. */\r\n    LogLevel[LogLevel[\"Information\"] = 2] = \"Information\";\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    LogLevel[LogLevel[\"Warning\"] = 3] = \"Warning\";\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    LogLevel[LogLevel[\"Error\"] = 4] = \"Error\";\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    LogLevel[LogLevel[\"Critical\"] = 5] = \"Critical\";\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    LogLevel[LogLevel[\"None\"] = 6] = \"None\";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map"],"sourceRoot":""}