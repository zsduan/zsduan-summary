{"version":3,"sources":["webpack:///./node_modules/@microsoft/signalr/dist/esm/ILogger.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/TextMessageFormat.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/HandshakeProtocol.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/Utils.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/Errors.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/HttpClient.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/FetchHttpClient.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/XhrHttpClient.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/IHubProtocol.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/DefaultHttpClient.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/Subject.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/HubConnection.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/ITransport.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/DefaultReconnectPolicy.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/AbortController.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/LongPollingTransport.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/ServerSentEventsTransport.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/WebSocketTransport.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/HttpConnection.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/JsonHubProtocol.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/HubConnectionBuilder.js","webpack:///./node_modules/@microsoft/signalr/dist/esm/Loggers.js"],"names":["LogLevel","TextMessageFormat","write","output","RecordSeparator","parse","input","length","Error","messages","split","pop","RecordSeparatorCode","String","fromCharCode","HandshakeProtocol","prototype","writeHandshakeRequest","handshakeRequest","JSON","stringify","parseHandshakeResponse","data","responseMessage","messageData","remainingData","Buffer","binaryData","Uint8Array","separatorIndex","indexOf","responseLength","apply","slice","byteLength","buffer","textData","substring","response","type","__assign","Object","assign","t","s","i","n","arguments","p","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","v","op","TypeError","push","VERSION","Arg","isRequired","val","name","undefined","isNotEmpty","match","isIn","values","Platform","defineProperty","get","window","enumerable","configurable","self","isBrowser","isWebWorker","getDataDetail","includeContent","detail","isArrayBuffer","formatArrayBuffer","view","str","forEach","num","pad","toString","substr","ArrayBuffer","constructor","sendMessage","logger","transportName","httpClient","url","accessTokenFactory","content","logMessageContent","withCredentials","defaultHeaders","_a","headers","token","_b","responseType","_c","getUserAgentHeader","log","Trace","post","statusCode","createLogger","ConsoleLogger","Information","instance","SubjectSubscription","subject","observer","dispose","index","observers","splice","cancelCallback","catch","minimumLogLevel","outputConsole","console","logLevel","message","Critical","error","Date","toISOString","Warning","warn","info","userAgentHeaderName","isNode","constructUserAgent","getOsName","getRuntime","getRuntimeVersion","version","os","runtime","runtimeVersion","userAgent","majorAndMinor","process","platform","versions","node","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","__","create","HttpError","_super","errorMessage","_newTarget","_this","trueProto","TimeoutError","AbortError","HttpResponse","statusText","HttpClient","options","send","method","delete","getCookieString","FetchHttpClient","fetch","requireFunc","jar","CookieJar","fetchType","abortControllerType","bind","AbortController","request","abortController","timeoutId","msTimeout","e_1","payload","abortSignal","aborted","onabort","abort","timeout","setTimeout","cache","credentials","mode","redirect","signal","clearTimeout","ok","status","deserializeContent","cookies","getCookies","c","join","arrayBuffer","text","MessageType","XhrHttpClient","xhr","XMLHttpRequest","open","setRequestHeader","keys","header","onload","responseText","onerror","ontimeout","DefaultHttpClient","HubConnectionState","Subject","item","_i","err","complete","subscribe","DEFAULT_TIMEOUT_IN_MS","DEFAULT_PING_INTERVAL_IN_MS","HttpTransportType","TransferFormat","HubConnection","connection","protocol","reconnectPolicy","nextKeepAlive","serverTimeoutInMilliseconds","keepAliveIntervalInMilliseconds","handshakeProtocol","onreceive","processIncomingData","onclose","connectionClosed","callbacks","methods","closedCallbacks","reconnectingCallbacks","reconnectedCallbacks","invocationId","receivedHandshakeResponse","connectionState","Disconnected","connectionStarted","cachedPingMessage","writeMessage","Ping","connectionId","baseUrl","set","Reconnecting","start","startPromise","startWithStateTransitions","Connecting","Debug","startInternal","Connected","handshakePromise","e_2","stopDuringStartError","handshakeResolver","handshakeRejecter","transferFormat","cleanupTimeout","resetTimeoutPeriod","resetKeepAliveInterval","cleanupPingTimer","stop","stopPromise","stopInternal","Disconnecting","reconnectDelayHandle","completeClose","stream","methodName","args","promiseQueue","replaceStreamingParams","streams","streamIds","invocationDescriptor","createStreamInvocation","cancelInvocation","createCancelInvocation","sendWithProtocol","invocationEvent","Completion","launchStreams","sendPromise","createInvocation","invoke","on","newMethod","toLowerCase","off","handlers","removeIdx","callback","onreconnecting","onreconnected","processHandshakeResponse","parseMessages","messages_1","Invocation","invokeClientMethod","StreamItem","Close","allowReconnect","features","inherentKeepAlive","getTime","timeoutHandle","serverTimeout","pingServerHandle","nextPing","invocationMessage","target","m","cancelCallbacksWithError","reconnect","reconnectStartTime","previousReconnectAttempts","retryError","nextRetryDelay","e_4","now","getNextRetryDelay","previousRetryCount","elapsedMilliseconds","retryReason","nextRetryDelayInMilliseconds","key","nonblocking","_loop_1","streamId","createCompletionMessage","createStreamItemMessage","argument","isObservable","arg","StreamInvocation","id","CancelInvocation","DEFAULT_RETRY_DELAYS_IN_MILLISECONDS","DefaultReconnectPolicy","retryDelays","concat","retryContext","isAborted","LongPollingTransport","pollAbort","running","connect","pollOptions","pollUrl","Binary","getAccessToken","updateHeaderToken","closeError","receiving","poll","pollAborted","raiseOnClose","name_1","deleteOptions","logMessage","ServerSentEventsTransport","eventSourceConstructor","encodeURIComponent","opened","Text","eventSource","Cookie","onmessage","close","onopen","WebSocketTransport","webSocketConstructor","webSocket","replace","binaryType","_event","event","ErrorEvent","readyState","OPEN","isCloseEvent","wasClean","code","reason","MAX_REDIRECTS","HttpConnection","stopPromiseResolver","negotiateVersion","resolveUrl","webSocketModule","eventSourceModule","WebSocket","EventSource","startInternalPromise","sendQueue","TransportSendQueue","transport","stopError","stopConnection","negotiateResponse","redirects","this_1","e_3","skipNegotiation","WebSockets","constructTransport","startTransport","accessToken_1","getNegotiationResponse","ProtocolVersion","accessToken","createTransport","negotiateUrl","resolveNegotiateUrl","connectionToken","createConnectUrl","requestedTransport","requestedTransferFormat","connectUrl","transportExceptions","transports","negotiate","transports_1","endpoint","transportOrError","ex_1","ex_2","isITransport","availableTransports","resolveTransportOrError","ServerSentEvents","LongPolling","transportMatches","transferFormats","map","ex","lastIndexOf","document","aTag","createElement","href","actualTransport","executing","sendBufferedData","PromiseSource","transportResult","sendLoopPromise","sendLoop","bufferData","promise","error_1","concatBuffers","arrayBuffers","totalLength","reduce","a","offset","arrayBuffers_1","resolver","rejecter","JSON_HUB_PROTOCOL_NAME","JsonHubProtocol","hubMessages","parsedMessage","isInvocationMessage","isStreamItemMessage","isCompletionMessage","assertNotEmptyString","LogLevelNameMapping","trace","debug","information","warning","critical","none","None","parseLogLevel","mapping","HubConnectionBuilder","configureLogging","logging","isLogger","withUrl","transportTypeOrOptions","httpConnectionOptions","withHubProtocol","withAutomaticReconnect","retryDelaysOrReconnectPolicy","isArray","build","NullLogger","_logLevel","_message"],"mappings":"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","file":"static/js/chunk-0c3f26a2.f6ff54f4.js","sourcesContent":["// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport var LogLevel;\r\n(function (LogLevel) {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\r\n    /** Log level for low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\r\n    /** Log level for informational diagnostic messages. */\r\n    LogLevel[LogLevel[\"Information\"] = 2] = \"Information\";\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    LogLevel[LogLevel[\"Warning\"] = 3] = \"Warning\";\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    LogLevel[LogLevel[\"Error\"] = 4] = \"Error\";\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    LogLevel[LogLevel[\"Critical\"] = 5] = \"Critical\";\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    LogLevel[LogLevel[\"None\"] = 6] = \"None\";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Not exported from index\r\n/** @private */\r\nvar TextMessageFormat = /** @class */ (function () {\r\n    function TextMessageFormat() {\r\n    }\r\n    TextMessageFormat.write = function (output) {\r\n        return \"\" + output + TextMessageFormat.RecordSeparator;\r\n    };\r\n    TextMessageFormat.parse = function (input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n        var messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    };\r\n    TextMessageFormat.RecordSeparatorCode = 0x1e;\r\n    TextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n    return TextMessageFormat;\r\n}());\r\nexport { TextMessageFormat };\r\n//# sourceMappingURL=TextMessageFormat.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nvar HandshakeProtocol = /** @class */ (function () {\r\n    function HandshakeProtocol() {\r\n    }\r\n    // Handshake request is always JSON\r\n    HandshakeProtocol.prototype.writeHandshakeRequest = function (handshakeRequest) {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    };\r\n    HandshakeProtocol.prototype.parseHandshakeResponse = function (data) {\r\n        var responseMessage;\r\n        var messageData;\r\n        var remainingData;\r\n        if (isArrayBuffer(data) || (typeof Buffer !== \"undefined\" && data instanceof Buffer)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            var binaryData = new Uint8Array(data);\r\n            var separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        }\r\n        else {\r\n            var textData = data;\r\n            var separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            var responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n        // At this point we should have just the single handshake message\r\n        var messages = TextMessageFormat.parse(messageData);\r\n        var response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        responseMessage = response;\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    };\r\n    return HandshakeProtocol;\r\n}());\r\nexport { HandshakeProtocol };\r\n//# sourceMappingURL=HandshakeProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\nexport var VERSION = \"5.0.17\";\r\n/** @private */\r\nvar Arg = /** @class */ (function () {\r\n    function Arg() {\r\n    }\r\n    Arg.isRequired = function (val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(\"The '\" + name + \"' argument is required.\");\r\n        }\r\n    };\r\n    Arg.isNotEmpty = function (val, name) {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(\"The '\" + name + \"' argument should not be empty.\");\r\n        }\r\n    };\r\n    Arg.isIn = function (val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(\"Unknown \" + name + \" value: \" + val + \".\");\r\n        }\r\n    };\r\n    return Arg;\r\n}());\r\nexport { Arg };\r\n/** @private */\r\nvar Platform = /** @class */ (function () {\r\n    function Platform() {\r\n    }\r\n    Object.defineProperty(Platform, \"isBrowser\", {\r\n        get: function () {\r\n            return typeof window === \"object\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isWebWorker\", {\r\n        get: function () {\r\n            return typeof self === \"object\" && \"importScripts\" in self;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Platform, \"isNode\", {\r\n        get: function () {\r\n            return !this.isBrowser && !this.isWebWorker;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Platform;\r\n}());\r\nexport { Platform };\r\n/** @private */\r\nexport function getDataDetail(data, includeContent) {\r\n    var detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = \"Binary data of length \" + data.byteLength;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + formatArrayBuffer(data) + \"'\";\r\n        }\r\n    }\r\n    else if (typeof data === \"string\") {\r\n        detail = \"String data of length \" + data.length;\r\n        if (includeContent) {\r\n            detail += \". Content: '\" + data + \"'\";\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n/** @private */\r\nexport function formatArrayBuffer(data) {\r\n    var view = new Uint8Array(data);\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    var str = \"\";\r\n    view.forEach(function (num) {\r\n        var pad = num < 16 ? \"0\" : \"\";\r\n        str += \"0x\" + pad + num.toString(16) + \" \";\r\n    });\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val) {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n/** @private */\r\nexport function sendMessage(logger, transportName, httpClient, url, accessTokenFactory, content, logMessageContent, withCredentials, defaultHeaders) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, headers, token, _b, name, value, responseType, response;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    headers = {};\r\n                    if (!accessTokenFactory) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, accessTokenFactory()];\r\n                case 1:\r\n                    token = _c.sent();\r\n                    if (token) {\r\n                        headers = (_a = {},\r\n                            _a[\"Authorization\"] = \"Bearer \" + token,\r\n                            _a);\r\n                    }\r\n                    _c.label = 2;\r\n                case 2:\r\n                    _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                    headers[name] = value;\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) sending data. \" + getDataDetail(content, logMessageContent) + \".\");\r\n                    responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n                    return [4 /*yield*/, httpClient.post(url, {\r\n                            content: content,\r\n                            headers: __assign({}, headers, defaultHeaders),\r\n                            responseType: responseType,\r\n                            withCredentials: withCredentials,\r\n                        })];\r\n                case 3:\r\n                    response = _c.sent();\r\n                    logger.log(LogLevel.Trace, \"(\" + transportName + \" transport) request complete. Response status: \" + response.statusCode + \".\");\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** @private */\r\nexport function createLogger(logger) {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n    if (logger.log) {\r\n        return logger;\r\n    }\r\n    return new ConsoleLogger(logger);\r\n}\r\n/** @private */\r\nvar SubjectSubscription = /** @class */ (function () {\r\n    function SubjectSubscription(subject, observer) {\r\n        this.subject = subject;\r\n        this.observer = observer;\r\n    }\r\n    SubjectSubscription.prototype.dispose = function () {\r\n        var index = this.subject.observers.indexOf(this.observer);\r\n        if (index > -1) {\r\n            this.subject.observers.splice(index, 1);\r\n        }\r\n        if (this.subject.observers.length === 0 && this.subject.cancelCallback) {\r\n            this.subject.cancelCallback().catch(function (_) { });\r\n        }\r\n    };\r\n    return SubjectSubscription;\r\n}());\r\nexport { SubjectSubscription };\r\n/** @private */\r\nvar ConsoleLogger = /** @class */ (function () {\r\n    function ConsoleLogger(minimumLogLevel) {\r\n        this.minimumLogLevel = minimumLogLevel;\r\n        this.outputConsole = console;\r\n    }\r\n    ConsoleLogger.prototype.log = function (logLevel, message) {\r\n        if (logLevel >= this.minimumLogLevel) {\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.outputConsole.error(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.outputConsole.warn(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.outputConsole.info(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.outputConsole.log(\"[\" + new Date().toISOString() + \"] \" + LogLevel[logLevel] + \": \" + message);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    return ConsoleLogger;\r\n}());\r\nexport { ConsoleLogger };\r\n/** @private */\r\nexport function getUserAgentHeader() {\r\n    var userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\r\n}\r\n/** @private */\r\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    var userAgent = \"Microsoft SignalR/\";\r\n    var majorAndMinor = version.split(\".\");\r\n    userAgent += majorAndMinor[0] + \".\" + majorAndMinor[1];\r\n    userAgent += \" (\" + version + \"; \";\r\n    if (os && os !== \"\") {\r\n        userAgent += os + \"; \";\r\n    }\r\n    else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n    userAgent += \"\" + runtime;\r\n    if (runtimeVersion) {\r\n        userAgent += \"; \" + runtimeVersion;\r\n    }\r\n    else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\nfunction getOsName() {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\nfunction getRuntimeVersion() {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\nfunction getRuntime() {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    }\r\n    else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n//# sourceMappingURL=Utils.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\n/** Error thrown when an HTTP request fails. */\r\nvar HttpError = /** @class */ (function (_super) {\r\n    __extends(HttpError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    function HttpError(errorMessage, statusCode) {\r\n        var _newTarget = this.constructor;\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        _this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return HttpError;\r\n}(Error));\r\nexport { HttpError };\r\n/** Error thrown when a timeout elapses. */\r\nvar TimeoutError = /** @class */ (function (_super) {\r\n    __extends(TimeoutError, _super);\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function TimeoutError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"A timeout occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return TimeoutError;\r\n}(Error));\r\nexport { TimeoutError };\r\n/** Error thrown when an action is aborted. */\r\nvar AbortError = /** @class */ (function (_super) {\r\n    __extends(AbortError, _super);\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    function AbortError(errorMessage) {\r\n        var _newTarget = this.constructor;\r\n        if (errorMessage === void 0) { errorMessage = \"An abort occurred.\"; }\r\n        var _this = this;\r\n        var trueProto = _newTarget.prototype;\r\n        _this = _super.call(this, errorMessage) || this;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        _this.__proto__ = trueProto;\r\n        return _this;\r\n    }\r\n    return AbortError;\r\n}(Error));\r\nexport { AbortError };\r\n//# sourceMappingURL=Errors.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\n/** Represents an HTTP response. */\r\nvar HttpResponse = /** @class */ (function () {\r\n    function HttpResponse(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n    return HttpResponse;\r\n}());\r\nexport { HttpResponse };\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nvar HttpClient = /** @class */ (function () {\r\n    function HttpClient() {\r\n    }\r\n    HttpClient.prototype.get = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"GET\", url: url }));\r\n    };\r\n    HttpClient.prototype.post = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"POST\", url: url }));\r\n    };\r\n    HttpClient.prototype.delete = function (url, options) {\r\n        return this.send(__assign({}, options, { method: \"DELETE\", url: url }));\r\n    };\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    HttpClient.prototype.getCookieString = function (url) {\r\n        return \"\";\r\n    };\r\n    return HttpClient;\r\n}());\r\nexport { HttpClient };\r\n//# sourceMappingURL=HttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Platform } from \"./Utils\";\r\nvar FetchHttpClient = /** @class */ (function (_super) {\r\n    __extends(FetchHttpClient, _super);\r\n    function FetchHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        if (typeof fetch === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            _this.jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n            _this.fetchType = requireFunc(\"node-fetch\");\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            _this.fetchType = requireFunc(\"fetch-cookie\")(_this.fetchType, _this.jar);\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            _this.abortControllerType = requireFunc(\"abort-controller\");\r\n        }\r\n        else {\r\n            _this.fetchType = fetch.bind(self);\r\n            _this.abortControllerType = AbortController;\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    FetchHttpClient.prototype.send = function (request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var abortController, error, timeoutId, msTimeout, response, e_1, content, payload;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Check that abort was not signaled before calling send\r\n                        if (request.abortSignal && request.abortSignal.aborted) {\r\n                            throw new AbortError();\r\n                        }\r\n                        if (!request.method) {\r\n                            throw new Error(\"No method defined.\");\r\n                        }\r\n                        if (!request.url) {\r\n                            throw new Error(\"No url defined.\");\r\n                        }\r\n                        abortController = new this.abortControllerType();\r\n                        // Hook our abortSignal into the abort controller\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = function () {\r\n                                abortController.abort();\r\n                                error = new AbortError();\r\n                            };\r\n                        }\r\n                        timeoutId = null;\r\n                        if (request.timeout) {\r\n                            msTimeout = request.timeout;\r\n                            timeoutId = setTimeout(function () {\r\n                                abortController.abort();\r\n                                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                                error = new TimeoutError();\r\n                            }, msTimeout);\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, 4, 5]);\r\n                        return [4 /*yield*/, this.fetchType(request.url, {\r\n                                body: request.content,\r\n                                cache: \"no-cache\",\r\n                                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                                headers: __assign({ \"Content-Type\": \"text/plain;charset=UTF-8\", \"X-Requested-With\": \"XMLHttpRequest\" }, request.headers),\r\n                                method: request.method,\r\n                                mode: \"cors\",\r\n                                redirect: \"manual\",\r\n                                signal: abortController.signal,\r\n                            })];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        if (error) {\r\n                            throw error;\r\n                        }\r\n                        this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + e_1 + \".\");\r\n                        throw e_1;\r\n                    case 4:\r\n                        if (timeoutId) {\r\n                            clearTimeout(timeoutId);\r\n                        }\r\n                        if (request.abortSignal) {\r\n                            request.abortSignal.onabort = null;\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 5:\r\n                        if (!response.ok) {\r\n                            throw new HttpError(response.statusText, response.status);\r\n                        }\r\n                        content = deserializeContent(response, request.responseType);\r\n                        return [4 /*yield*/, content];\r\n                    case 6:\r\n                        payload = _a.sent();\r\n                        return [2 /*return*/, new HttpResponse(response.status, response.statusText, payload)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    FetchHttpClient.prototype.getCookieString = function (url) {\r\n        var cookies = \"\";\r\n        if (Platform.isNode && this.jar) {\r\n            // @ts-ignore: unused variable\r\n            this.jar.getCookies(url, function (e, c) { return cookies = c.join(\"; \"); });\r\n        }\r\n        return cookies;\r\n    };\r\n    return FetchHttpClient;\r\n}(HttpClient));\r\nexport { FetchHttpClient };\r\nfunction deserializeContent(response, responseType) {\r\n    var content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(responseType + \" is not supported.\");\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n    return content;\r\n}\r\n//# sourceMappingURL=FetchHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nvar XhrHttpClient = /** @class */ (function (_super) {\r\n    __extends(XhrHttpClient, _super);\r\n    function XhrHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    XhrHttpClient.prototype.send = function (request) {\r\n        var _this = this;\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n            var headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach(function (header) {\r\n                    xhr.setRequestHeader(header, headers[header]);\r\n                });\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = function () {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = function () {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new HttpError(xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Error from HTTP request. \" + xhr.status + \": \" + xhr.statusText + \".\");\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = function () {\r\n                _this.logger.log(LogLevel.Warning, \"Timeout from HTTP request.\");\r\n                reject(new TimeoutError());\r\n            };\r\n            xhr.send(request.content || \"\");\r\n        });\r\n    };\r\n    return XhrHttpClient;\r\n}(HttpClient));\r\nexport { XhrHttpClient };\r\n//# sourceMappingURL=XhrHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** Defines the type of a Hub Message. */\r\nexport var MessageType;\r\n(function (MessageType) {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    MessageType[MessageType[\"Invocation\"] = 1] = \"Invocation\";\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    MessageType[MessageType[\"StreamItem\"] = 2] = \"StreamItem\";\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    MessageType[MessageType[\"Completion\"] = 3] = \"Completion\";\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    MessageType[MessageType[\"StreamInvocation\"] = 4] = \"StreamInvocation\";\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    MessageType[MessageType[\"CancelInvocation\"] = 5] = \"CancelInvocation\";\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    MessageType[MessageType[\"Ping\"] = 6] = \"Ping\";\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    MessageType[MessageType[\"Close\"] = 7] = \"Close\";\r\n})(MessageType || (MessageType = {}));\r\n//# sourceMappingURL=IHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nvar DefaultHttpClient = /** @class */ (function (_super) {\r\n    __extends(DefaultHttpClient, _super);\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    function DefaultHttpClient(logger) {\r\n        var _this = _super.call(this) || this;\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            _this.httpClient = new FetchHttpClient(logger);\r\n        }\r\n        else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            _this.httpClient = new XhrHttpClient(logger);\r\n        }\r\n        else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n        return _this;\r\n    }\r\n    /** @inheritDoc */\r\n    DefaultHttpClient.prototype.send = function (request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return this.httpClient.send(request);\r\n    };\r\n    DefaultHttpClient.prototype.getCookieString = function (url) {\r\n        return this.httpClient.getCookieString(url);\r\n    };\r\n    return DefaultHttpClient;\r\n}(HttpClient));\r\nexport { DefaultHttpClient };\r\n//# sourceMappingURL=DefaultHttpClient.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { SubjectSubscription } from \"./Utils\";\r\n/** Stream implementation to stream items to the server. */\r\nvar Subject = /** @class */ (function () {\r\n    function Subject() {\r\n        this.observers = [];\r\n    }\r\n    Subject.prototype.next = function (item) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            observer.next(item);\r\n        }\r\n    };\r\n    Subject.prototype.error = function (err) {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.complete = function () {\r\n        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {\r\n            var observer = _a[_i];\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    };\r\n    Subject.prototype.subscribe = function (observer) {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    };\r\n    return Subject;\r\n}());\r\nexport { Subject };\r\n//# sourceMappingURL=Subject.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { HandshakeProtocol } from \"./HandshakeProtocol\";\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg } from \"./Utils\";\r\nvar DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nvar DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport var HubConnectionState;\r\n(function (HubConnectionState) {\r\n    /** The hub connection is disconnected. */\r\n    HubConnectionState[\"Disconnected\"] = \"Disconnected\";\r\n    /** The hub connection is connecting. */\r\n    HubConnectionState[\"Connecting\"] = \"Connecting\";\r\n    /** The hub connection is connected. */\r\n    HubConnectionState[\"Connected\"] = \"Connected\";\r\n    /** The hub connection is disconnecting. */\r\n    HubConnectionState[\"Disconnecting\"] = \"Disconnecting\";\r\n    /** The hub connection is reconnecting. */\r\n    HubConnectionState[\"Reconnecting\"] = \"Reconnecting\";\r\n})(HubConnectionState || (HubConnectionState = {}));\r\n/** Represents a connection to a SignalR Hub. */\r\nvar HubConnection = /** @class */ (function () {\r\n    function HubConnection(connection, logger, protocol, reconnectPolicy) {\r\n        var _this = this;\r\n        this.nextKeepAlive = 0;\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.serverTimeoutInMilliseconds = DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = DEFAULT_PING_INTERVAL_IN_MS;\r\n        this.logger = logger;\r\n        this.protocol = protocol;\r\n        this.connection = connection;\r\n        this.reconnectPolicy = reconnectPolicy;\r\n        this.handshakeProtocol = new HandshakeProtocol();\r\n        this.connection.onreceive = function (data) { return _this.processIncomingData(data); };\r\n        this.connection.onclose = function (error) { return _this.connectionClosed(error); };\r\n        this.callbacks = {};\r\n        this.methods = {};\r\n        this.closedCallbacks = [];\r\n        this.reconnectingCallbacks = [];\r\n        this.reconnectedCallbacks = [];\r\n        this.invocationId = 0;\r\n        this.receivedHandshakeResponse = false;\r\n        this.connectionState = HubConnectionState.Disconnected;\r\n        this.connectionStarted = false;\r\n        this.cachedPingMessage = this.protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    HubConnection.create = function (connection, logger, protocol, reconnectPolicy) {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy);\r\n    };\r\n    Object.defineProperty(HubConnection.prototype, \"state\", {\r\n        /** Indicates the state of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connectionState;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"connectionId\", {\r\n        /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n         *  in the disconnected state or if the negotiation step was skipped.\r\n         */\r\n        get: function () {\r\n            return this.connection ? (this.connection.connectionId || null) : null;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(HubConnection.prototype, \"baseUrl\", {\r\n        /** Indicates the url of the {@link HubConnection} to the server. */\r\n        get: function () {\r\n            return this.connection.baseUrl || \"\";\r\n        },\r\n        /**\r\n         * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n         * Reconnecting states.\r\n         * @param {string} url The url to connect to.\r\n         */\r\n        set: function (url) {\r\n            if (this.connectionState !== HubConnectionState.Disconnected && this.connectionState !== HubConnectionState.Reconnecting) {\r\n                throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n            }\r\n            if (!url) {\r\n                throw new Error(\"The HubConnection url must be a valid url.\");\r\n            }\r\n            this.connection.baseUrl = url;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.start = function () {\r\n        this.startPromise = this.startWithStateTransitions();\r\n        return this.startPromise;\r\n    };\r\n    HubConnection.prototype.startWithStateTransitions = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState !== HubConnectionState.Disconnected) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Connecting;\r\n                        this.logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.connectionStarted = true;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        this.connectionState = HubConnectionState.Disconnected;\r\n                        this.logger.log(LogLevel.Debug, \"HubConnection failed to start successfully because of error '\" + e_1 + \"'.\");\r\n                        return [2 /*return*/, Promise.reject(e_1)];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.startInternal = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var handshakePromise, handshakeRequest, e_2;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.stopDuringStartError = undefined;\r\n                        this.receivedHandshakeResponse = false;\r\n                        handshakePromise = new Promise(function (resolve, reject) {\r\n                            _this.handshakeResolver = resolve;\r\n                            _this.handshakeRejecter = reject;\r\n                        });\r\n                        return [4 /*yield*/, this.connection.start(this.protocol.transferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 7]);\r\n                        handshakeRequest = {\r\n                            protocol: this.protocol.name,\r\n                            version: this.protocol.version,\r\n                        };\r\n                        this.logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n                        return [4 /*yield*/, this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(handshakeRequest))];\r\n                    case 3:\r\n                        _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Using HubProtocol '\" + this.protocol.name + \"'.\");\r\n                        // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n                        this.cleanupTimeout();\r\n                        this.resetTimeoutPeriod();\r\n                        this.resetKeepAliveInterval();\r\n                        return [4 /*yield*/, handshakePromise];\r\n                    case 4:\r\n                        _a.sent();\r\n                        // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n                        // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n                        // and the connection was closed.\r\n                        if (this.stopDuringStartError) {\r\n                            // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                            // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                            // will cause the calling continuation to get scheduled to run later.\r\n                            throw this.stopDuringStartError;\r\n                        }\r\n                        return [3 /*break*/, 7];\r\n                    case 5:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Debug, \"Hub handshake failed with error '\" + e_2 + \"' during start(). Stopping HubConnection.\");\r\n                        this.cleanupTimeout();\r\n                        this.cleanupPingTimer();\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        return [4 /*yield*/, this.connection.stop(e_2)];\r\n                    case 6:\r\n                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n                        _a.sent();\r\n                        throw e_2;\r\n                    case 7: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var startPromise, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        startPromise = this.startPromise;\r\n                        this.stopPromise = this.stopInternal();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        // Awaiting undefined continues immediately\r\n                        return [4 /*yield*/, startPromise];\r\n                    case 3:\r\n                        // Awaiting undefined continues immediately\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_3 = _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.stopInternal = function (error) {\r\n        if (this.connectionState === HubConnectionState.Disconnected) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HubConnection.stop(\" + error + \") ignored because it is already in the disconnected state.\");\r\n            return Promise.resolve();\r\n        }\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n            return this.stopPromise;\r\n        }\r\n        this.connectionState = HubConnectionState.Disconnecting;\r\n        this.logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n        if (this.reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this.logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n            clearTimeout(this.reconnectDelayHandle);\r\n            this.reconnectDelayHandle = undefined;\r\n            this.completeClose();\r\n            return Promise.resolve();\r\n        }\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        this.stopDuringStartError = error || new Error(\"The connection was stopped before the hub handshake could complete.\");\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    };\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    HubConnection.prototype.stream = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createStreamInvocation(methodName, args, streamIds);\r\n        var promiseQueue;\r\n        var subject = new Subject();\r\n        subject.cancelCallback = function () {\r\n            var cancelInvocation = _this.createCancelInvocation(invocationDescriptor.invocationId);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n            return promiseQueue.then(function () {\r\n                return _this.sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n        this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    }\r\n                    else {\r\n                        subject.complete();\r\n                    }\r\n                }\r\n                else {\r\n                    subject.next((invocationEvent.item));\r\n                }\r\n            }\r\n        };\r\n        promiseQueue = this.sendWithProtocol(invocationDescriptor)\r\n            .catch(function (e) {\r\n            subject.error(e);\r\n            delete _this.callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        this.launchStreams(streams, promiseQueue);\r\n        return subject;\r\n    };\r\n    HubConnection.prototype.sendMessage = function (message) {\r\n        this.resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    };\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    HubConnection.prototype.sendWithProtocol = function (message) {\r\n        return this.sendMessage(this.protocol.writeMessage(message));\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    HubConnection.prototype.send = function (methodName) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var sendPromise = this.sendWithProtocol(this.createInvocation(methodName, args, true, streamIds));\r\n        this.launchStreams(streams, sendPromise);\r\n        return sendPromise;\r\n    };\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    HubConnection.prototype.invoke = function (methodName) {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];\r\n        var invocationDescriptor = this.createInvocation(methodName, args, false, streamIds);\r\n        var p = new Promise(function (resolve, reject) {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            _this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        }\r\n                        else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(new Error(\"Unexpected message type: \" + invocationEvent.type));\r\n                    }\r\n                }\r\n            };\r\n            var promiseQueue = _this.sendWithProtocol(invocationDescriptor)\r\n                .catch(function (e) {\r\n                reject(e);\r\n                // invocationId will always have a value for a non-blocking invocation\r\n                delete _this.callbacks[invocationDescriptor.invocationId];\r\n            });\r\n            _this.launchStreams(streams, promiseQueue);\r\n        });\r\n        return p;\r\n    };\r\n    /** Registers a handler that will be invoked when the hub method with the specified method name is invoked.\r\n     *\r\n     * @param {string} methodName The name of the hub method to define.\r\n     * @param {Function} newMethod The handler that will be raised when the hub method is invoked.\r\n     */\r\n    HubConnection.prototype.on = function (methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this.methods[methodName]) {\r\n            this.methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this.methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this.methods[methodName].push(newMethod);\r\n    };\r\n    HubConnection.prototype.off = function (methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        var handlers = this.methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            var removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this.methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this.methods[methodName];\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    HubConnection.prototype.onclose = function (callback) {\r\n        if (callback) {\r\n            this.closedCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    HubConnection.prototype.onreconnecting = function (callback) {\r\n        if (callback) {\r\n            this.reconnectingCallbacks.push(callback);\r\n        }\r\n    };\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    HubConnection.prototype.onreconnected = function (callback) {\r\n        if (callback) {\r\n            this.reconnectedCallbacks.push(callback);\r\n        }\r\n    };\r\n    HubConnection.prototype.processIncomingData = function (data) {\r\n        this.cleanupTimeout();\r\n        if (!this.receivedHandshakeResponse) {\r\n            data = this.processHandshakeResponse(data);\r\n            this.receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            var messages = this.protocol.parseMessages(data, this.logger);\r\n            for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n                var message = messages_1[_i];\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this.invokeClientMethod(message);\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion:\r\n                        var callback = this.callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this.callbacks[message.invocationId];\r\n                            }\r\n                            callback(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close:\r\n                        this.logger.log(LogLevel.Information, \"Close message received from server.\");\r\n                        var error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n                            // tslint:disable-next-line:no-floating-promises\r\n                            this.connection.stop(error);\r\n                        }\r\n                        else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this.stopPromise = this.stopInternal(error);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this.logger.log(LogLevel.Warning, \"Invalid message type: \" + message.type + \".\");\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.resetTimeoutPeriod();\r\n    };\r\n    HubConnection.prototype.processHandshakeResponse = function (data) {\r\n        var _a;\r\n        var responseMessage;\r\n        var remainingData;\r\n        try {\r\n            _a = this.handshakeProtocol.parseHandshakeResponse(data), remainingData = _a[0], responseMessage = _a[1];\r\n        }\r\n        catch (e) {\r\n            var message = \"Error parsing handshake response: \" + e;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            var message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this.logger.log(LogLevel.Error, message);\r\n            var error = new Error(message);\r\n            this.handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n        this.handshakeResolver();\r\n        return remainingData;\r\n    };\r\n    HubConnection.prototype.resetKeepAliveInterval = function () {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this.nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n        this.cleanupPingTimer();\r\n    };\r\n    HubConnection.prototype.resetTimeoutPeriod = function () {\r\n        var _this = this;\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this.timeoutHandle = setTimeout(function () { return _this.serverTimeout(); }, this.serverTimeoutInMilliseconds);\r\n            // Set keepAlive timer if there isn't one\r\n            if (this.pingServerHandle === undefined) {\r\n                var nextPing = this.nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this.pingServerHandle = setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                    var _a;\r\n                    return __generator(this, function (_b) {\r\n                        switch (_b.label) {\r\n                            case 0:\r\n                                if (!(this.connectionState === HubConnectionState.Connected)) return [3 /*break*/, 4];\r\n                                _b.label = 1;\r\n                            case 1:\r\n                                _b.trys.push([1, 3, , 4]);\r\n                                return [4 /*yield*/, this.sendMessage(this.cachedPingMessage)];\r\n                            case 2:\r\n                                _b.sent();\r\n                                return [3 /*break*/, 4];\r\n                            case 3:\r\n                                _a = _b.sent();\r\n                                // We don't care about the error. It should be seen elsewhere in the client.\r\n                                // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                                this.cleanupPingTimer();\r\n                                return [3 /*break*/, 4];\r\n                            case 4: return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); }, nextPing);\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.serverTimeout = function () {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // tslint:disable-next-line:no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    };\r\n    HubConnection.prototype.invokeClientMethod = function (invocationMessage) {\r\n        var _this = this;\r\n        var methods = this.methods[invocationMessage.target.toLowerCase()];\r\n        if (methods) {\r\n            try {\r\n                methods.forEach(function (m) { return m.apply(_this, invocationMessage.arguments); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"A callback for the method \" + invocationMessage.target.toLowerCase() + \" threw error '\" + e + \"'.\");\r\n            }\r\n            if (invocationMessage.invocationId) {\r\n                // This is not supported in v1. So we return an error to avoid blocking the server waiting for the response.\r\n                var message = \"Server requested a response, which is not supported in this version of the client.\";\r\n                this.logger.log(LogLevel.Error, message);\r\n                // We don't want to wait on the stop itself.\r\n                this.stopPromise = this.stopInternal(new Error(message));\r\n            }\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Warning, \"No client method with the name '\" + invocationMessage.target + \"' found.\");\r\n        }\r\n    };\r\n    HubConnection.prototype.connectionClosed = function (error) {\r\n        this.logger.log(LogLevel.Debug, \"HubConnection.connectionClosed(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this.stopDuringStartError = this.stopDuringStartError || error || new Error(\"The underlying connection was closed before the hub handshake could complete.\");\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this.handshakeResolver) {\r\n            this.handshakeResolver();\r\n        }\r\n        this.cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n        this.cleanupTimeout();\r\n        this.cleanupPingTimer();\r\n        if (this.connectionState === HubConnectionState.Disconnecting) {\r\n            this.completeClose(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected && this.reconnectPolicy) {\r\n            // tslint:disable-next-line:no-floating-promises\r\n            this.reconnect(error);\r\n        }\r\n        else if (this.connectionState === HubConnectionState.Connected) {\r\n            this.completeClose(error);\r\n        }\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    };\r\n    HubConnection.prototype.completeClose = function (error) {\r\n        var _this = this;\r\n        if (this.connectionStarted) {\r\n            this.connectionState = HubConnectionState.Disconnected;\r\n            this.connectionStarted = false;\r\n            try {\r\n                this.closedCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"An onclose callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.reconnect = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var reconnectStartTime, previousReconnectAttempts, retryError, nextRetryDelay, e_4;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        reconnectStartTime = Date.now();\r\n                        previousReconnectAttempts = 0;\r\n                        retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n                        if (nextRetryDelay === null) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n                            this.completeClose(error);\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this.connectionState = HubConnectionState.Reconnecting;\r\n                        if (error) {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting because of error '\" + error + \"'.\");\r\n                        }\r\n                        else {\r\n                            this.logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n                        }\r\n                        if (this.onreconnecting) {\r\n                            try {\r\n                                this.reconnectingCallbacks.forEach(function (c) { return c.apply(_this, [error]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnecting callback called with error '\" + error + \"' threw error '\" + e + \"'.\");\r\n                            }\r\n                            // Exit early if an onreconnecting callback called connection.stop().\r\n                            if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                                this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(nextRetryDelay !== null)) return [3 /*break*/, 7];\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt number \" + previousReconnectAttempts + \" will start in \" + nextRetryDelay + \" ms.\");\r\n                        return [4 /*yield*/, new Promise(function (resolve) {\r\n                                _this.reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);\r\n                            })];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.reconnectDelayHandle = undefined;\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.startInternal()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        this.connectionState = HubConnectionState.Connected;\r\n                        this.logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n                        if (this.onreconnected) {\r\n                            try {\r\n                                this.reconnectedCallbacks.forEach(function (c) { return c.apply(_this, [_this.connection.connectionId]); });\r\n                            }\r\n                            catch (e) {\r\n                                this.logger.log(LogLevel.Error, \"An onreconnected callback called with connectionId '\" + this.connection.connectionId + \"; threw error '\" + e + \"'.\");\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                    case 5:\r\n                        e_4 = _a.sent();\r\n                        this.logger.log(LogLevel.Information, \"Reconnect attempt failed because of error '\" + e_4 + \"'.\");\r\n                        if (this.connectionState !== HubConnectionState.Reconnecting) {\r\n                            this.logger.log(LogLevel.Debug, \"Connection moved to the '\" + this.connectionState + \"' from the reconnecting state during reconnect attempt. Done reconnecting.\");\r\n                            // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                            if (this.connectionState === HubConnectionState.Disconnecting) {\r\n                                this.completeClose();\r\n                            }\r\n                            return [2 /*return*/];\r\n                        }\r\n                        retryError = e_4 instanceof Error ? e_4 : new Error(e_4.toString());\r\n                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7:\r\n                        this.logger.log(LogLevel.Information, \"Reconnect retries have been exhausted after \" + (Date.now() - reconnectStartTime) + \" ms and \" + previousReconnectAttempts + \" failed attempts. Connection disconnecting.\");\r\n                        this.completeClose();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HubConnection.prototype.getNextRetryDelay = function (previousRetryCount, elapsedMilliseconds, retryReason) {\r\n        try {\r\n            return this.reconnectPolicy.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds: elapsedMilliseconds,\r\n                previousRetryCount: previousRetryCount,\r\n                retryReason: retryReason,\r\n            });\r\n        }\r\n        catch (e) {\r\n            this.logger.log(LogLevel.Error, \"IRetryPolicy.nextRetryDelayInMilliseconds(\" + previousRetryCount + \", \" + elapsedMilliseconds + \") threw error '\" + e + \"'.\");\r\n            return null;\r\n        }\r\n    };\r\n    HubConnection.prototype.cancelCallbacksWithError = function (error) {\r\n        var callbacks = this.callbacks;\r\n        this.callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach(function (key) {\r\n            var callback = callbacks[key];\r\n            callback(null, error);\r\n        });\r\n    };\r\n    HubConnection.prototype.cleanupPingTimer = function () {\r\n        if (this.pingServerHandle) {\r\n            clearTimeout(this.pingServerHandle);\r\n            this.pingServerHandle = undefined;\r\n        }\r\n    };\r\n    HubConnection.prototype.cleanupTimeout = function () {\r\n        if (this.timeoutHandle) {\r\n            clearTimeout(this.timeoutHandle);\r\n        }\r\n    };\r\n    HubConnection.prototype.createInvocation = function (methodName, args, nonblocking, streamIds) {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            var invocationId = this.invocationId;\r\n            this.invocationId++;\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds: streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    };\r\n    HubConnection.prototype.launchStreams = function (streams, promiseQueue) {\r\n        var _this = this;\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n        var _loop_1 = function (streamId) {\r\n            streams[streamId].subscribe({\r\n                complete: function () {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId)); });\r\n                },\r\n                error: function (err) {\r\n                    var message;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    }\r\n                    else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    }\r\n                    else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId, message)); });\r\n                },\r\n                next: function (item) {\r\n                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createStreamItemMessage(streamId, item)); });\r\n                },\r\n            });\r\n        };\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // tslint:disable-next-line:forin\r\n        for (var streamId in streams) {\r\n            _loop_1(streamId);\r\n        }\r\n    };\r\n    HubConnection.prototype.replaceStreamingParams = function (args) {\r\n        var streams = [];\r\n        var streamIds = [];\r\n        for (var i = 0; i < args.length; i++) {\r\n            var argument = args[i];\r\n            if (this.isObservable(argument)) {\r\n                var streamId = this.invocationId;\r\n                this.invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n        return [streams, streamIds];\r\n    };\r\n    HubConnection.prototype.isObservable = function (arg) {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    };\r\n    HubConnection.prototype.createStreamInvocation = function (methodName, args, streamIds) {\r\n        var invocationId = this.invocationId;\r\n        this.invocationId++;\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds: streamIds,\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    };\r\n    HubConnection.prototype.createCancelInvocation = function (id) {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    };\r\n    HubConnection.prototype.createStreamItemMessage = function (id, item) {\r\n        return {\r\n            invocationId: id,\r\n            item: item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    };\r\n    HubConnection.prototype.createCompletionMessage = function (id, error, result) {\r\n        if (error) {\r\n            return {\r\n                error: error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n        return {\r\n            invocationId: id,\r\n            result: result,\r\n            type: MessageType.Completion,\r\n        };\r\n    };\r\n    return HubConnection;\r\n}());\r\nexport { HubConnection };\r\n//# sourceMappingURL=HubConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport var HttpTransportType;\r\n(function (HttpTransportType) {\r\n    /** Specifies no transport preference. */\r\n    HttpTransportType[HttpTransportType[\"None\"] = 0] = \"None\";\r\n    /** Specifies the WebSockets transport. */\r\n    HttpTransportType[HttpTransportType[\"WebSockets\"] = 1] = \"WebSockets\";\r\n    /** Specifies the Server-Sent Events transport. */\r\n    HttpTransportType[HttpTransportType[\"ServerSentEvents\"] = 2] = \"ServerSentEvents\";\r\n    /** Specifies the Long Polling transport. */\r\n    HttpTransportType[HttpTransportType[\"LongPolling\"] = 4] = \"LongPolling\";\r\n})(HttpTransportType || (HttpTransportType = {}));\r\n/** Specifies the transfer format for a connection. */\r\nexport var TransferFormat;\r\n(function (TransferFormat) {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Text\"] = 1] = \"Text\";\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Binary\"] = 2] = \"Binary\";\r\n})(TransferFormat || (TransferFormat = {}));\r\n//# sourceMappingURL=ITransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nvar DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n/** @private */\r\nvar DefaultReconnectPolicy = /** @class */ (function () {\r\n    function DefaultReconnectPolicy(retryDelays) {\r\n        this.retryDelays = retryDelays !== undefined ? retryDelays.concat([null]) : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n    DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds = function (retryContext) {\r\n        return this.retryDelays[retryContext.previousRetryCount];\r\n    };\r\n    return DefaultReconnectPolicy;\r\n}());\r\nexport { DefaultReconnectPolicy };\r\n//# sourceMappingURL=DefaultReconnectPolicy.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n// Not exported from index.\r\n/** @private */\r\nvar AbortController = /** @class */ (function () {\r\n    function AbortController() {\r\n        this.isAborted = false;\r\n        this.onabort = null;\r\n    }\r\n    AbortController.prototype.abort = function () {\r\n        if (!this.isAborted) {\r\n            this.isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    };\r\n    Object.defineProperty(AbortController.prototype, \"signal\", {\r\n        get: function () {\r\n            return this;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AbortController.prototype, \"aborted\", {\r\n        get: function () {\r\n            return this.isAborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return AbortController;\r\n}());\r\nexport { AbortController };\r\n//# sourceMappingURL=AbortController.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nvar LongPollingTransport = /** @class */ (function () {\r\n    function LongPollingTransport(httpClient, accessTokenFactory, logger, logMessageContent, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.pollAbort = new AbortController();\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.headers = headers;\r\n        this.running = false;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    Object.defineProperty(LongPollingTransport.prototype, \"pollAborted\", {\r\n        // This is an internal type, not exported from 'index' so this is really just internal.\r\n        get: function () {\r\n            return this.pollAbort.aborted;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LongPollingTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, _b, name, value, headers, pollOptions, token, pollUrl, response;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.url = url;\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n                        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n                        if (transferFormat === TransferFormat.Binary &&\r\n                            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n                            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n                        }\r\n                        _b = getUserAgentHeader(), name = _b[0], value = _b[1];\r\n                        headers = __assign((_a = {}, _a[name] = value, _a), this.headers);\r\n                        pollOptions = {\r\n                            abortSignal: this.pollAbort.signal,\r\n                            headers: headers,\r\n                            timeout: 100000,\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        if (transferFormat === TransferFormat.Binary) {\r\n                            pollOptions.responseType = \"arraybuffer\";\r\n                        }\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 1:\r\n                        token = _c.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 2:\r\n                        response = _c.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Mark running as false so that the poll immediately ends and runs the close logic\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            this.running = true;\r\n                        }\r\n                        this.receiving = this.poll(this.url, pollOptions);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.getAccessToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                    case 2: return [2 /*return*/, null];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.updateHeaderToken = function (request, token) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (token) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            request.headers[\"Authorization\"] = \"Bearer \" + token;\r\n            return;\r\n        }\r\n        // tslint:disable-next-line:no-string-literal\r\n        if (request.headers[\"Authorization\"]) {\r\n            // tslint:disable-next-line:no-string-literal\r\n            delete request.headers[\"Authorization\"];\r\n        }\r\n    };\r\n    LongPollingTransport.prototype.poll = function (url, pollOptions) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token, pollUrl, response, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, , 8, 9]);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!this.running) return [3 /*break*/, 7];\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 2:\r\n                        token = _a.sent();\r\n                        this.updateHeaderToken(pollOptions, token);\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 6]);\r\n                        pollUrl = url + \"&_=\" + Date.now();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) polling: \" + pollUrl + \".\");\r\n                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];\r\n                    case 4:\r\n                        response = _a.sent();\r\n                        if (response.statusCode === 204) {\r\n                            this.logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n                            this.running = false;\r\n                        }\r\n                        else if (response.statusCode !== 200) {\r\n                            this.logger.log(LogLevel.Error, \"(LongPolling transport) Unexpected response code: \" + response.statusCode + \".\");\r\n                            // Unexpected status code\r\n                            this.closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                            this.running = false;\r\n                        }\r\n                        else {\r\n                            // Process the response\r\n                            if (response.content) {\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) data received. \" + getDataDetail(response.content, this.logMessageContent) + \".\");\r\n                                if (this.onreceive) {\r\n                                    this.onreceive(response.content);\r\n                                }\r\n                            }\r\n                            else {\r\n                                // This is another way timeout manifest.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        e_1 = _a.sent();\r\n                        if (!this.running) {\r\n                            // Log but disregard errors that occur after stopping\r\n                            this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll errored after shutdown: \" + e_1.message);\r\n                        }\r\n                        else {\r\n                            if (e_1 instanceof TimeoutError) {\r\n                                // Ignore timeouts and reissue the poll.\r\n                                this.logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                            }\r\n                            else {\r\n                                // Close the connection with the error as the result.\r\n                                this.closeError = e_1;\r\n                                this.running = false;\r\n                            }\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 6: return [3 /*break*/, 1];\r\n                    case 7: return [3 /*break*/, 9];\r\n                    case 8:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n                        // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n                        // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n                        if (!this.pollAborted) {\r\n                            this.raiseOnClose();\r\n                        }\r\n                        return [7 /*endfinally*/];\r\n                    case 9: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.running) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"LongPolling\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.stop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, _a, name_1, value, deleteOptions, token;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n                        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n                        this.running = false;\r\n                        this.pollAbort.abort();\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, , 5, 6]);\r\n                        return [4 /*yield*/, this.receiving];\r\n                    case 2:\r\n                        _b.sent();\r\n                        // Send DELETE to clean up long polling on the server\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) sending DELETE request to \" + this.url + \".\");\r\n                        headers = {};\r\n                        _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                        headers[name_1] = value;\r\n                        deleteOptions = {\r\n                            headers: __assign({}, headers, this.headers),\r\n                            withCredentials: this.withCredentials,\r\n                        };\r\n                        return [4 /*yield*/, this.getAccessToken()];\r\n                    case 3:\r\n                        token = _b.sent();\r\n                        this.updateHeaderToken(deleteOptions, token);\r\n                        return [4 /*yield*/, this.httpClient.delete(this.url, deleteOptions)];\r\n                    case 4:\r\n                        _b.sent();\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request sent.\");\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        this.logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n                        // Raise close event here instead of in polling\r\n                        // It needs to happen after the DELETE request is sent\r\n                        this.raiseOnClose();\r\n                        return [7 /*endfinally*/];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    LongPollingTransport.prototype.raiseOnClose = function () {\r\n        if (this.onclose) {\r\n            var logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this.closeError) {\r\n                logMessage += \" Error: \" + this.closeError;\r\n            }\r\n            this.logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this.closeError);\r\n        }\r\n    };\r\n    return LongPollingTransport;\r\n}());\r\nexport { LongPollingTransport };\r\n//# sourceMappingURL=LongPollingTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\n/** @private */\r\nvar ServerSentEventsTransport = /** @class */ (function () {\r\n    function ServerSentEventsTransport(httpClient, accessTokenFactory, logger, logMessageContent, eventSourceConstructor, withCredentials, headers) {\r\n        this.httpClient = httpClient;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logger = logger;\r\n        this.logMessageContent = logMessageContent;\r\n        this.withCredentials = withCredentials;\r\n        this.eventSourceConstructor = eventSourceConstructor;\r\n        this.headers = headers;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    ServerSentEventsTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n                        // set url before accessTokenFactory because this.url is only for send and we set the auth header instead of the query string for send\r\n                        this.url = url;\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            var opened = false;\r\n                            if (transferFormat !== TransferFormat.Text) {\r\n                                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                                return;\r\n                            }\r\n                            var eventSource;\r\n                            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials });\r\n                            }\r\n                            else {\r\n                                // Non-browser passes cookies via the dictionary\r\n                                var cookies = _this.httpClient.getCookieString(url);\r\n                                var headers = {};\r\n                                headers.Cookie = cookies;\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials, headers: __assign({}, headers, _this.headers) });\r\n                            }\r\n                            try {\r\n                                eventSource.onmessage = function (e) {\r\n                                    if (_this.onreceive) {\r\n                                        try {\r\n                                            _this.logger.log(LogLevel.Trace, \"(SSE transport) data received. \" + getDataDetail(e.data, _this.logMessageContent) + \".\");\r\n                                            _this.onreceive(e.data);\r\n                                        }\r\n                                        catch (error) {\r\n                                            _this.close(error);\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                };\r\n                                eventSource.onerror = function (e) {\r\n                                    var error = new Error(e.data || \"Error occurred\");\r\n                                    if (opened) {\r\n                                        _this.close(error);\r\n                                    }\r\n                                    else {\r\n                                        reject(error);\r\n                                    }\r\n                                };\r\n                                eventSource.onopen = function () {\r\n                                    _this.logger.log(LogLevel.Information, \"SSE connected to \" + _this.url);\r\n                                    _this.eventSource = eventSource;\r\n                                    opened = true;\r\n                                    resolve();\r\n                                };\r\n                            }\r\n                            catch (e) {\r\n                                reject(e);\r\n                                return;\r\n                            }\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.send = function (data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!this.eventSource) {\r\n                    return [2 /*return*/, Promise.reject(new Error(\"Cannot send until the transport is connected\"))];\r\n                }\r\n                return [2 /*return*/, sendMessage(this.logger, \"SSE\", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];\r\n            });\r\n        });\r\n    };\r\n    ServerSentEventsTransport.prototype.stop = function () {\r\n        this.close();\r\n        return Promise.resolve();\r\n    };\r\n    ServerSentEventsTransport.prototype.close = function (e) {\r\n        if (this.eventSource) {\r\n            this.eventSource.close();\r\n            this.eventSource = undefined;\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    };\r\n    return ServerSentEventsTransport;\r\n}());\r\nexport { ServerSentEventsTransport };\r\n//# sourceMappingURL=ServerSentEventsTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n/** @private */\r\nvar WebSocketTransport = /** @class */ (function () {\r\n    function WebSocketTransport(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {\r\n        this.logger = logger;\r\n        this.accessTokenFactory = accessTokenFactory;\r\n        this.logMessageContent = logMessageContent;\r\n        this.webSocketConstructor = webSocketConstructor;\r\n        this.httpClient = httpClient;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this.headers = headers;\r\n    }\r\n    WebSocketTransport.prototype.connect = function (url, transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var token;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        Arg.isRequired(url, \"url\");\r\n                        Arg.isRequired(transferFormat, \"transferFormat\");\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (token) {\r\n                            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + (\"access_token=\" + encodeURIComponent(token));\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                            url = url.replace(/^http/, \"ws\");\r\n                            var webSocket;\r\n                            var cookies = _this.httpClient.getCookieString(url);\r\n                            var opened = false;\r\n                            if (Platform.isNode) {\r\n                                var headers = {};\r\n                                var _a = getUserAgentHeader(), name_1 = _a[0], value = _a[1];\r\n                                headers[name_1] = value;\r\n                                if (cookies) {\r\n                                    headers[\"Cookie\"] = \"\" + cookies;\r\n                                }\r\n                                // Only pass headers when in non-browser environments\r\n                                webSocket = new _this.webSocketConstructor(url, undefined, {\r\n                                    headers: __assign({}, headers, _this.headers),\r\n                                });\r\n                            }\r\n                            if (!webSocket) {\r\n                                // Chrome is not happy with passing 'undefined' as protocol\r\n                                webSocket = new _this.webSocketConstructor(url);\r\n                            }\r\n                            if (transferFormat === TransferFormat.Binary) {\r\n                                webSocket.binaryType = \"arraybuffer\";\r\n                            }\r\n                            // tslint:disable-next-line:variable-name\r\n                            webSocket.onopen = function (_event) {\r\n                                _this.logger.log(LogLevel.Information, \"WebSocket connected to \" + url + \".\");\r\n                                _this.webSocket = webSocket;\r\n                                opened = true;\r\n                                resolve();\r\n                            };\r\n                            webSocket.onerror = function (event) {\r\n                                var error = null;\r\n                                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                    error = event.error;\r\n                                }\r\n                                else {\r\n                                    error = new Error(\"There was an error with the transport.\");\r\n                                }\r\n                                reject(error);\r\n                            };\r\n                            webSocket.onmessage = function (message) {\r\n                                _this.logger.log(LogLevel.Trace, \"(WebSockets transport) data received. \" + getDataDetail(message.data, _this.logMessageContent) + \".\");\r\n                                if (_this.onreceive) {\r\n                                    try {\r\n                                        _this.onreceive(message.data);\r\n                                    }\r\n                                    catch (error) {\r\n                                        _this.close(error);\r\n                                        return;\r\n                                    }\r\n                                }\r\n                            };\r\n                            webSocket.onclose = function (event) {\r\n                                // Don't call close handler if connection was never established\r\n                                // We'll reject the connect call instead\r\n                                if (opened) {\r\n                                    _this.close(event);\r\n                                }\r\n                                else {\r\n                                    var error = null;\r\n                                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                                        error = event.error;\r\n                                    }\r\n                                    else {\r\n                                        error = new Error(\"There was an error with the transport.\");\r\n                                    }\r\n                                    reject(error);\r\n                                }\r\n                            };\r\n                        })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WebSocketTransport.prototype.send = function (data) {\r\n        if (this.webSocket && this.webSocket.readyState === this.webSocketConstructor.OPEN) {\r\n            this.logger.log(LogLevel.Trace, \"(WebSockets transport) sending data. \" + getDataDetail(data, this.logMessageContent) + \".\");\r\n            this.webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    };\r\n    WebSocketTransport.prototype.stop = function () {\r\n        if (this.webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this.close(undefined);\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    WebSocketTransport.prototype.close = function (event) {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this.webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this.webSocket.onclose = function () { };\r\n            this.webSocket.onmessage = function () { };\r\n            this.webSocket.onerror = function () { };\r\n            this.webSocket.close();\r\n            this.webSocket = undefined;\r\n        }\r\n        this.logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n        if (this.onclose) {\r\n            if (this.isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(\"WebSocket closed with status code: \" + event.code + \" (\" + event.reason + \").\"));\r\n            }\r\n            else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            }\r\n            else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    };\r\n    WebSocketTransport.prototype.isCloseEvent = function (event) {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    };\r\n    return WebSocketTransport;\r\n}());\r\nexport { WebSocketTransport };\r\n//# sourceMappingURL=WebSocketTransport.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nvar MAX_REDIRECTS = 100;\r\n/** @private */\r\nvar HttpConnection = /** @class */ (function () {\r\n    function HttpConnection(url, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.stopPromiseResolver = function () { };\r\n        this.features = {};\r\n        this.negotiateVersion = 1;\r\n        Arg.isRequired(url, \"url\");\r\n        this.logger = createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        }\r\n        else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        var webSocketModule = null;\r\n        var eventSourceModule = null;\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n        this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        this.connectionStarted = false;\r\n        this.options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    HttpConnection.prototype.start = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var message, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        transferFormat = transferFormat || TransferFormat.Binary;\r\n                        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n                        this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\r\n                        if (this.connectionState !== \"Disconnected\" /* Disconnected */) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"))];\r\n                        }\r\n                        this.connectionState = \"Connecting\" /* Connecting */;\r\n                        this.startInternalPromise = this.startInternal(transferFormat);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!(this.connectionState === \"Disconnecting\" /* Disconnecting */)) return [3 /*break*/, 3];\r\n                        message = \"Failed to start the HttpConnection before stop() was called.\";\r\n                        this.logger.log(LogLevel.Error, message);\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n                        _a.sent();\r\n                        return [2 /*return*/, Promise.reject(new Error(message))];\r\n                    case 3:\r\n                        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n                            message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n                            this.logger.log(LogLevel.Error, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        this.connectionStarted = true;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.send = function (data) {\r\n        if (this.connectionState !== \"Connected\" /* Connected */) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n        if (!this.sendQueue) {\r\n            this.sendQueue = new TransportSendQueue(this.transport);\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this.sendQueue.send(data);\r\n    };\r\n    HttpConnection.prototype.stop = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnected state.\");\r\n                            return [2 /*return*/, Promise.resolve()];\r\n                        }\r\n                        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n                            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stop(\" + error + \") ignored because the connection is already in the disconnecting state.\");\r\n                            return [2 /*return*/, this.stopPromise];\r\n                        }\r\n                        this.connectionState = \"Disconnecting\" /* Disconnecting */;\r\n                        this.stopPromise = new Promise(function (resolve) {\r\n                            // Don't complete stop() until stopConnection() completes.\r\n                            _this.stopPromiseResolver = resolve;\r\n                        });\r\n                        // stopInternal should never throw so just observe it.\r\n                        return [4 /*yield*/, this.stopInternal(error)];\r\n                    case 1:\r\n                        // stopInternal should never throw so just observe it.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.stopPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.stopInternal = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        // Set error as soon as possible otherwise there is a race between\r\n                        // the transport closing and providing an error and the error from a close message\r\n                        // We would prefer the close message error.\r\n                        this.stopError = error;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startInternalPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        if (!this.transport) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.transport.stop()];\r\n                    case 6:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"HttpConnection.transport.stop() threw error '\" + e_2 + \"'.\");\r\n                        this.stopConnection();\r\n                        return [3 /*break*/, 8];\r\n                    case 8:\r\n                        this.transport = undefined;\r\n                        return [3 /*break*/, 10];\r\n                    case 9:\r\n                        this.logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n                        _a.label = 10;\r\n                    case 10: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.startInternal = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var url, negotiateResponse, redirects, _loop_1, this_1, e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this.baseUrl;\r\n                        this.accessTokenFactory = this.options.accessTokenFactory;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 12, , 13]);\r\n                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];\r\n                        if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\r\n                        // No need to add a connection ID in this case\r\n                        this.transport = this.constructTransport(HttpTransportType.WebSockets);\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        return [4 /*yield*/, this.startTransport(url, transferFormat)];\r\n                    case 2:\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                    case 4: return [3 /*break*/, 11];\r\n                    case 5:\r\n                        negotiateResponse = null;\r\n                        redirects = 0;\r\n                        _loop_1 = function () {\r\n                            var accessToken_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];\r\n                                    case 1:\r\n                                        negotiateResponse = _a.sent();\r\n                                        // the user tries to stop the connection when it is being started\r\n                                        if (this_1.connectionState === \"Disconnecting\" /* Disconnecting */ || this_1.connectionState === \"Disconnected\" /* Disconnected */) {\r\n                                            throw new Error(\"The connection was stopped during negotiation.\");\r\n                                        }\r\n                                        if (negotiateResponse.error) {\r\n                                            throw new Error(negotiateResponse.error);\r\n                                        }\r\n                                        if (negotiateResponse.ProtocolVersion) {\r\n                                            throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                                        }\r\n                                        if (negotiateResponse.url) {\r\n                                            url = negotiateResponse.url;\r\n                                        }\r\n                                        if (negotiateResponse.accessToken) {\r\n                                            accessToken_1 = negotiateResponse.accessToken;\r\n                                            this_1.accessTokenFactory = function () { return accessToken_1; };\r\n                                        }\r\n                                        redirects++;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        };\r\n                        this_1 = this;\r\n                        _a.label = 6;\r\n                    case 6: return [5 /*yield**/, _loop_1()];\r\n                    case 7:\r\n                        _a.sent();\r\n                        _a.label = 8;\r\n                    case 8:\r\n                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                            throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                        }\r\n                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        _a.label = 11;\r\n                    case 11:\r\n                        if (this.transport instanceof LongPollingTransport) {\r\n                            this.features.inherentKeepAlive = true;\r\n                        }\r\n                        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n                            // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                            // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                            this.logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                            this.connectionState = \"Connected\" /* Connected */;\r\n                        }\r\n                        return [3 /*break*/, 13];\r\n                    case 12:\r\n                        e_3 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_3);\r\n                        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n                        this.transport = undefined;\r\n                        // if start fails, any active calls to stop assume that start will complete the stop promise\r\n                        this.stopPromiseResolver();\r\n                        return [2 /*return*/, Promise.reject(e_3)];\r\n                    case 13: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.getNegotiationResponse = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, token, _a, name, value, negotiateUrl, response, negotiateResponse, e_4;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        headers = {};\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _b.sent();\r\n                        if (token) {\r\n                            headers[\"Authorization\"] = \"Bearer \" + token;\r\n                        }\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _a = getUserAgentHeader(), name = _a[0], value = _a[1];\r\n                        headers[name] = value;\r\n                        negotiateUrl = this.resolveNegotiateUrl(url);\r\n                        this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl + \".\");\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _b.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\r\n                                content: \"\",\r\n                                headers: __assign({}, headers, this.options.headers),\r\n                                withCredentials: this.options.withCredentials,\r\n                            })];\r\n                    case 4:\r\n                        response = _b.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unexpected status code returned from negotiate '\" + response.statusCode + \"'\"))];\r\n                        }\r\n                        negotiateResponse = JSON.parse(response.content);\r\n                        if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                            // Negotiate version 0 doesn't use connectionToken\r\n                            // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                            negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n                        }\r\n                        return [2 /*return*/, negotiateResponse];\r\n                    case 5:\r\n                        e_4 = _b.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_4);\r\n                        return [2 /*return*/, Promise.reject(e_4)];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.createConnectUrl = function (url, connectionToken) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionToken);\r\n    };\r\n    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var connectUrl, transportExceptions, transports, negotiate, _i, transports_1, endpoint, transportOrError, ex_1, ex_2, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionToken);\r\n                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\r\n                        this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n                        this.transport = requestedTransport;\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.connectionId = negotiateResponse.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 2:\r\n                        transportExceptions = [];\r\n                        transports = negotiateResponse.availableTransports || [];\r\n                        negotiate = negotiateResponse;\r\n                        _i = 0, transports_1 = transports;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (!(_i < transports_1.length)) return [3 /*break*/, 13];\r\n                        endpoint = transports_1[_i];\r\n                        transportOrError = this.resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat);\r\n                        if (!(transportOrError instanceof Error)) return [3 /*break*/, 4];\r\n                        // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + transportOrError);\r\n                        return [3 /*break*/, 12];\r\n                    case 4:\r\n                        if (!this.isITransport(transportOrError)) return [3 /*break*/, 12];\r\n                        this.transport = transportOrError;\r\n                        if (!!negotiate) return [3 /*break*/, 9];\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.getNegotiationResponse(url)];\r\n                    case 6:\r\n                        negotiate = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        ex_1 = _a.sent();\r\n                        return [2 /*return*/, Promise.reject(ex_1)];\r\n                    case 8:\r\n                        connectUrl = this.createConnectUrl(url, negotiate.connectionToken);\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        _a.trys.push([9, 11, , 12]);\r\n                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        this.connectionId = negotiate.connectionId;\r\n                        return [2 /*return*/];\r\n                    case 11:\r\n                        ex_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + endpoint.transport + \"': \" + ex_2);\r\n                        negotiate = undefined;\r\n                        transportExceptions.push(endpoint.transport + \" failed: \" + ex_2);\r\n                        if (this.connectionState !== \"Connecting\" /* Connecting */) {\r\n                            message = \"Failed to select transport before stop() was called.\";\r\n                            this.logger.log(LogLevel.Debug, message);\r\n                            return [2 /*return*/, Promise.reject(new Error(message))];\r\n                        }\r\n                        return [3 /*break*/, 12];\r\n                    case 12:\r\n                        _i++;\r\n                        return [3 /*break*/, 3];\r\n                    case 13:\r\n                        if (transportExceptions.length > 0) {\r\n                            return [2 /*return*/, Promise.reject(new Error(\"Unable to connect to the server with any of the available transports. \" + transportExceptions.join(\" \")))];\r\n                        }\r\n                        return [2 /*return*/, Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"))];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.constructTransport = function (transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this.options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket, this.options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this.options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource, this.options.withCredentials, this.options.headers || {});\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.withCredentials, this.options.headers || {});\r\n            default:\r\n                throw new Error(\"Unknown transport: \" + transport + \".\");\r\n        }\r\n    };\r\n    HttpConnection.prototype.startTransport = function (url, transferFormat) {\r\n        var _this = this;\r\n        this.transport.onreceive = this.onreceive;\r\n        this.transport.onclose = function (e) { return _this.stopConnection(e); };\r\n        return this.transport.connect(url, transferFormat);\r\n    };\r\n    HttpConnection.prototype.resolveTransportOrError = function (endpoint, requestedTransport, requestedTransferFormat) {\r\n        var transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n            return new Error(\"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n        }\r\n        else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                var transferFormats = endpoint.transferFormats.map(function (s) { return TransferFormat[s]; });\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this.options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this.options.EventSource)) {\r\n                        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\r\n                        return new Error(\"'\" + HttpTransportType[transport] + \"' is not supported in your environment.\");\r\n                    }\r\n                    else {\r\n                        this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'.\");\r\n                        try {\r\n                            return this.constructTransport(transport);\r\n                        }\r\n                        catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\r\n                    return new Error(\"'\" + HttpTransportType[transport] + \"' does not support \" + TransferFormat[requestedTransferFormat] + \".\");\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\r\n                return new Error(\"'\" + HttpTransportType[transport] + \"' is disabled by the client.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.isITransport = function (transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    };\r\n    HttpConnection.prototype.stopConnection = function (error) {\r\n        var _this = this;\r\n        this.logger.log(LogLevel.Debug, \"HttpConnection.stopConnection(\" + error + \") called while in state \" + this.connectionState + \".\");\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this.stopError || error;\r\n        this.stopError = undefined;\r\n        if (this.connectionState === \"Disconnected\" /* Disconnected */) {\r\n            this.logger.log(LogLevel.Debug, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is already in the disconnected state.\");\r\n            return;\r\n        }\r\n        if (this.connectionState === \"Connecting\" /* Connecting */) {\r\n            this.logger.log(LogLevel.Warning, \"Call to HttpConnection.stopConnection(\" + error + \") was ignored because the connection is still in the connecting state.\");\r\n            throw new Error(\"HttpConnection.stopConnection(\" + error + \") was called while the connection is still in the connecting state.\");\r\n        }\r\n        if (this.connectionState === \"Disconnecting\" /* Disconnecting */) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this.stopPromiseResolver();\r\n        }\r\n        if (error) {\r\n            this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        if (this.sendQueue) {\r\n            this.sendQueue.stop().catch(function (e) {\r\n                _this.logger.log(LogLevel.Error, \"TransportSendQueue.stop() threw error '\" + e + \"'.\");\r\n            });\r\n            this.sendQueue = undefined;\r\n        }\r\n        this.connectionId = undefined;\r\n        this.connectionState = \"Disconnected\" /* Disconnected */;\r\n        if (this.connectionStarted) {\r\n            this.connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                this.logger.log(LogLevel.Error, \"HttpConnection.onclose(\" + error + \") threw error '\" + e + \"'.\");\r\n            }\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveUrl = function (url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (!Platform.isBrowser || !window.document) {\r\n            throw new Error(\"Cannot resolve '\" + url + \"'.\");\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        var aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\r\n        return aTag.href;\r\n    };\r\n    HttpConnection.prototype.resolveNegotiateUrl = function (url) {\r\n        var index = url.indexOf(\"?\");\r\n        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\r\n            negotiateUrl += \"/\";\r\n        }\r\n        negotiateUrl += \"negotiate\";\r\n        negotiateUrl += index === -1 ? \"\" : url.substring(index);\r\n        if (negotiateUrl.indexOf(\"negotiateVersion\") === -1) {\r\n            negotiateUrl += index === -1 ? \"?\" : \"&\";\r\n            negotiateUrl += \"negotiateVersion=\" + this.negotiateVersion;\r\n        }\r\n        return negotiateUrl;\r\n    };\r\n    return HttpConnection;\r\n}());\r\nexport { HttpConnection };\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n/** @private */\r\nvar TransportSendQueue = /** @class */ (function () {\r\n    function TransportSendQueue(transport) {\r\n        this.transport = transport;\r\n        this.buffer = [];\r\n        this.executing = true;\r\n        this.sendBufferedData = new PromiseSource();\r\n        this.transportResult = new PromiseSource();\r\n        this.sendLoopPromise = this.sendLoop();\r\n    }\r\n    TransportSendQueue.prototype.send = function (data) {\r\n        this.bufferData(data);\r\n        if (!this.transportResult) {\r\n            this.transportResult = new PromiseSource();\r\n        }\r\n        return this.transportResult.promise;\r\n    };\r\n    TransportSendQueue.prototype.stop = function () {\r\n        this.executing = false;\r\n        this.sendBufferedData.resolve();\r\n        return this.sendLoopPromise;\r\n    };\r\n    TransportSendQueue.prototype.bufferData = function (data) {\r\n        if (this.buffer.length && typeof (this.buffer[0]) !== typeof (data)) {\r\n            throw new Error(\"Expected data to be of type \" + typeof (this.buffer) + \" but was of type \" + typeof (data));\r\n        }\r\n        this.buffer.push(data);\r\n        this.sendBufferedData.resolve();\r\n    };\r\n    TransportSendQueue.prototype.sendLoop = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var transportResult, data, error_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!true) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.sendBufferedData.promise];\r\n                    case 1:\r\n                        _a.sent();\r\n                        if (!this.executing) {\r\n                            if (this.transportResult) {\r\n                                this.transportResult.reject(\"Connection stopped.\");\r\n                            }\r\n                            return [3 /*break*/, 6];\r\n                        }\r\n                        this.sendBufferedData = new PromiseSource();\r\n                        transportResult = this.transportResult;\r\n                        this.transportResult = undefined;\r\n                        data = typeof (this.buffer[0]) === \"string\" ?\r\n                            this.buffer.join(\"\") :\r\n                            TransportSendQueue.concatBuffers(this.buffer);\r\n                        this.buffer.length = 0;\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.transport.send(data)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        transportResult.resolve();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        error_1 = _a.sent();\r\n                        transportResult.reject(error_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [3 /*break*/, 0];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    TransportSendQueue.concatBuffers = function (arrayBuffers) {\r\n        var totalLength = arrayBuffers.map(function (b) { return b.byteLength; }).reduce(function (a, b) { return a + b; });\r\n        var result = new Uint8Array(totalLength);\r\n        var offset = 0;\r\n        for (var _i = 0, arrayBuffers_1 = arrayBuffers; _i < arrayBuffers_1.length; _i++) {\r\n            var item = arrayBuffers_1[_i];\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n        return result.buffer;\r\n    };\r\n    return TransportSendQueue;\r\n}());\r\nexport { TransportSendQueue };\r\nvar PromiseSource = /** @class */ (function () {\r\n    function PromiseSource() {\r\n        var _this = this;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            var _a;\r\n            return _a = [resolve, reject], _this.resolver = _a[0], _this.rejecter = _a[1], _a;\r\n        });\r\n    }\r\n    PromiseSource.prototype.resolve = function () {\r\n        this.resolver();\r\n    };\r\n    PromiseSource.prototype.reject = function (reason) {\r\n        this.rejecter(reason);\r\n    };\r\n    return PromiseSource;\r\n}());\r\n//# sourceMappingURL=HttpConnection.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nvar JSON_HUB_PROTOCOL_NAME = \"json\";\r\n/** Implements the JSON Hub Protocol. */\r\nvar JsonHubProtocol = /** @class */ (function () {\r\n    function JsonHubProtocol() {\r\n        /** @inheritDoc */\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        /** @inheritDoc */\r\n        this.version = 1;\r\n        /** @inheritDoc */\r\n        this.transferFormat = TransferFormat.Text;\r\n    }\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    JsonHubProtocol.prototype.parseMessages = function (input, logger) {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n        // Parse the messages\r\n        var messages = TextMessageFormat.parse(input);\r\n        var hubMessages = [];\r\n        for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {\r\n            var message = messages_1[_i];\r\n            var parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this.isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this.isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this.isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    };\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    JsonHubProtocol.prototype.writeMessage = function (message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    };\r\n    JsonHubProtocol.prototype.isInvocationMessage = function (message) {\r\n        this.assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n        if (message.invocationId !== undefined) {\r\n            this.assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isStreamItemMessage = function (message) {\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    };\r\n    JsonHubProtocol.prototype.isCompletionMessage = function (message) {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this.assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n        this.assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    };\r\n    JsonHubProtocol.prototype.assertNotEmptyString = function (value, errorMessage) {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    };\r\n    return JsonHubProtocol;\r\n}());\r\nexport { JsonHubProtocol };\r\n//# sourceMappingURL=JsonHubProtocol.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\n// tslint:disable:object-literal-sort-keys\r\nvar LogLevelNameMapping = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\nfunction parseLogLevel(name) {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    var mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    }\r\n    else {\r\n        throw new Error(\"Unknown log level: \" + name);\r\n    }\r\n}\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nvar HubConnectionBuilder = /** @class */ (function () {\r\n    function HubConnectionBuilder() {\r\n    }\r\n    HubConnectionBuilder.prototype.configureLogging = function (logging) {\r\n        Arg.isRequired(logging, \"logging\");\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        }\r\n        else if (typeof logging === \"string\") {\r\n            var logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        }\r\n        else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withUrl = function (url, transportTypeOrOptions) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n        this.url = url;\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, transportTypeOrOptions);\r\n        }\r\n        else {\r\n            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, { transport: transportTypeOrOptions });\r\n        }\r\n        return this;\r\n    };\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    HubConnectionBuilder.prototype.withHubProtocol = function (protocol) {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.protocol = protocol;\r\n        return this;\r\n    };\r\n    HubConnectionBuilder.prototype.withAutomaticReconnect = function (retryDelaysOrReconnectPolicy) {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        }\r\n        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        }\r\n        else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n        return this;\r\n    };\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    HubConnectionBuilder.prototype.build = function () {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        var httpConnectionOptions = this.httpConnectionOptions || {};\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        var connection = new HttpConnection(this.url, httpConnectionOptions);\r\n        return HubConnection.create(connection, this.logger || NullLogger.instance, this.protocol || new JsonHubProtocol(), this.reconnectPolicy);\r\n    };\r\n    return HubConnectionBuilder;\r\n}());\r\nexport { HubConnectionBuilder };\r\nfunction isLogger(logger) {\r\n    return logger.log !== undefined;\r\n}\r\n//# sourceMappingURL=HubConnectionBuilder.js.map","// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\n/** A logger that does nothing when log messages are sent to it. */\r\nvar NullLogger = /** @class */ (function () {\r\n    function NullLogger() {\r\n    }\r\n    /** @inheritDoc */\r\n    // tslint:disable-next-line\r\n    NullLogger.prototype.log = function (_logLevel, _message) {\r\n    };\r\n    /** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\n    NullLogger.instance = new NullLogger();\r\n    return NullLogger;\r\n}());\r\nexport { NullLogger };\r\n//# sourceMappingURL=Loggers.js.map"],"sourceRoot":""}